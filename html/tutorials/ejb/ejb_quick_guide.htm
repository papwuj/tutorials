<!DOCTYPE html>
<html lang="en-US">
<head>
<title>EJB - Quick Guide</title>
<meta charset="utf-8">
<meta name="description" content="EJB - Quick Guide - EJB stands for Enterprise Java Beans. EJB is an essential part of a J2EE platform. J2EE platform has component based architecture to provide multi-tiered, distr"/>
<meta name="keywords" content="C, C++, Python, Java, HTML, CSS, JavaScript, SQL, PHP, jQuery, XML, DOM, Bootstrap, Tutorials, Articles, Programming, training, learning, quiz, preferences, examples, code"/>
<link rel="canonical" href="https://www.tutorialspoint.com/ejb/ejb_quick_guide.htm" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes">
<script src="/theme/js/script-min-v2.js?v=3"></script>
<link rel="stylesheet" href="/theme/css/style-min-v2.css?v=6">
<script src="//services.bilsyndication.com/adv1/?d=901" defer="" async=""></script>
<script> var vitag = vitag || {};</script>
<script> vitag.outStreamConfig = { enablePC: false, enableMobile: false };</script>  
<style>
.right-menu .mui-btn {
    background-color:#ac1d01;
}
a.demo {
    background:#ac1d01;
}
li.heading {
    background:#ac1d01;
}
.course-box{background:#ac1d01}
.home-intro-sub p{color:#ac1d01}
</style>
</head>
<body>
<header id="header">
<!-- Top sub-menu Starts Here -->
<div class="mui-appbar mui-container-fulid top-menu">
<div class="mui-container">
<div class="top-menu-item home">
<a href="https://www.tutorialspoint.com/index.htm" target="_blank" title="TutorialsPoint - Home"><i class="fal fa-home"></i> <span>Home</span></a>
</div>
<div class="top-menu-item qa">
<a href="https://www.tutorialspoint.com/about/about_careers.htm" target="_blank" title="Job @ Tutorials Point"><i class="fa fa-suitcase"></i> <span>Jobs</span></a>
</div>
<div class="top-menu-item tools">
<a href="https://www.tutorialspoint.com/online_dev_tools.htm" target="_blank" title="Tools - Online Development and Testing Tools"><i class="fal fa-cogs"></i> <span>Tools</span></a>
</div>
<div class="top-menu-item coding-ground">
<a href="https://www.tutorialspoint.com/codingground.htm" target="_blank" title="Coding Ground - Free Online IDE and Terminal"><i class="fal fa-code"></i> <span>Coding Ground </span></a> 
</div>
<div class="top-menu-item current-affairs">
<a href="https://www.tutorialspoint.com/current_affairs.htm" target="_blank" title="Daily Current Affairs"><i class="fal fa-layer-plus"></i> <span>Current Affairs</span></a>
</div>
<div class="top-menu-item upsc-notes">
<a href="https://www.tutorialspoint.com/upsc_ias_exams.htm" target="_blank" title="UPSC IAS Exams Notes - TutorialsPoint"><i class="fal fa-user-tie"></i> <span>UPSC Notes</span></a>
</div>      
<div class="top-menu-item online-tutoris">
<a href="https://www.tutorialspoint.com/tutor_connect/index.php" target="_blank" title="Top Online Tutors - Tutor Connect"><i class="fal fa-user"></i> <span>Online Tutors</span></a>
</div>
<div class="top-menu-item whiteboard">
<a href="https://www.tutorialspoint.com/whiteboard.htm" target="_blank" title="Free Online Whiteboard"><i class="fal fa-chalkboard"></i> <span>Whiteboard</span></a>
</div>
<div class="top-menu-item net-meeting">
<a href="https://www.tutorialspoint.com/netmeeting.php" target="_blank" title="A free tool for online video conferencing"><i class="fal fa-chalkboard-teacher"></i> <span>Net Meeting</span></a> 
</div>
<div class="top-menu-item articles">
<a href="https://www.tutorix.com" target="_blank" title="Tutorx - The Best Learning App" rel="nofollow"><i class="fal fa-video"></i> <span>Tutorix</span></a> 
</div>        
<div class="social-menu-item">
<a href="https://www.facebook.com/tutorialspointindia" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint @ Facebook"><i class="fab fa-facebook-f"></i></a> 
<a href="https://www.twitter.com/tutorialspoint" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint @ Twitter"><i class="fab fa-twitter"></i></a>
<a href="https://www.linkedin.com/company/tutorialspoint" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint @ Linkedin"><i class="fab fa-linkedin-in"></i></a>
<a href="https://www.youtube.com/channel/UCVLbzhxVTiTLiVKeGV7WEBg" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint YouTube"><i class="fab fa-youtube"></i></a>
</div>        
</div>
</div>
<!-- Top sub-menu Ends Here -->
<!-- Top main-menu Starts Here -->
<div class="mui-appbar mui-container-fulid mui--appbar-line-height mui--z1" id="logo-menu">
<div class="mui-container">
<div class="left-menu">
<a href="https://www.tutorialspoint.com/index.htm" title="Tutorialspoint">
<img class="tp-logo" alt="tutorialspoint" src="/ejb/images/logo.png">
</a>
<div class="mui-dropdown">
<a class="mui-btn mui-btn--primary categories" data-mui-toggle="dropdown"><i class="fa fa-th-large"></i> 
<span>Categories <span class="mui-caret"></span></span></a>            
<ul class="mui-dropdown__menu cat-menu">
<li>
<ul>
<li><a href="/academic_tutorials.htm"><i class="fa fa-caret-right"></i> Academic Tutorials</a></li>
<li><a href="/big_data_tutorials.htm"><i class="fa fa-caret-right"></i> Big Data &amp; Analytics </a></li>
<li><a href="/computer_programming_tutorials.htm"><i class="fa fa-caret-right"></i> Computer Programming </a></li>
<li><a href="/computer_science_tutorials.htm"><i class="fa fa-caret-right"></i> Computer Science </a></li>
<li><a href="/database_tutorials.htm"><i class="fa fa-caret-right"></i> Databases </a></li>
<li><a href="/devops_tutorials.htm"><i class="fa fa-caret-right"></i> DevOps </a></li>
<li><a href="/digital_marketing_tutorials.htm"><i class="fa fa-caret-right"></i> Digital Marketing </a></li>
<li><a href="/engineering_tutorials.htm"><i class="fa fa-caret-right"></i> Engineering Tutorials </a></li>
<li><a href="/upsc_ias_exams.htm"><i class="fa fa-caret-right"></i> Exams Syllabus </a></li>
<li><a href="/famous_monuments.htm"><i class="fa fa-caret-right"></i> Famous Monuments </a></li>
<li><a href="/gate_exams_tutorials.htm"><i class="fa fa-caret-right"></i> GATE Exams Tutorials</a></li>
<li><a href="/latest_technologies.htm"><i class="fa fa-caret-right"></i> Latest Technologies </a></li>
<li><a href="/machine_learning_tutorials.htm"><i class="fa fa-caret-right"></i> Machine Learning </a></li>
<li><a href="/mainframe_tutorials.htm"><i class="fa fa-caret-right"></i> Mainframe Development </a></li>
<li><a href="/management_tutorials.htm"><i class="fa fa-caret-right"></i> Management Tutorials </a></li>
<li><a href="/maths_tutorials.htm"><i class="fa fa-caret-right"></i> Mathematics Tutorials</a></li>
<li><a href="/microsoft_technologies_tutorials.htm"><i class="fa fa-caret-right"></i> Microsoft Technologies </a></li>
<li><a href="/misc_tutorials.htm"><i class="fa fa-caret-right"></i> Misc tutorials </a></li>
<li><a href="/mobile_development_tutorials.htm"><i class="fa fa-caret-right"></i> Mobile Development </a></li>
<li><a href="/java_technology_tutorials.htm"><i class="fa fa-caret-right"></i> Java Technologies </a></li>
<li><a href="/python_technologies_tutorials.htm"><i class="fa fa-caret-right"></i> Python Technologies </a></li>
<li><a href="/sap_tutorials.htm"><i class="fa fa-caret-right"></i> SAP Tutorials </a></li>
<li><a href="/scripting_lnaguage_tutorials.htm"><i class="fa fa-caret-right"></i>Programming Scripts </a></li>
<li><a href="/selected_reading.htm"><i class="fa fa-caret-right"></i> Selected Reading </a></li>
<li><a href="/software_quality_tutorials.htm"><i class="fa fa-caret-right"></i> Software Quality </a></li>
<li><a href="/soft_skill_tutorials.htm"><i class="fa fa-caret-right"></i> Soft Skills </a></li>
<li><a href="/telecom_tutorials.htm"><i class="fa fa-caret-right"></i> Telecom Tutorials </a></li>
<li><a href="/upsc_ias_exams.htm"><i class="fa fa-caret-right"></i> UPSC IAS Exams </a></li>
<li><a href="/web_development_tutorials.htm"><i class="fa fa-caret-right"></i> Web Development </a></li>
<li><a href="/sports_tutorials.htm"><i class="fa fa-caret-right"></i> Sports Tutorials </a></li>
<li><a href="/xml_technologies_tutorials.htm"><i class="fa fa-caret-right"></i> XML Technologies </a></li>
<li><a href="/multi_language_tutorials.htm"><i class="fa fa-caret-right"></i> Multi-Language Tutorials</a></li>
<li><a href="/questions_and_answers.htm"><i class="fa fa-caret-right"></i> Interview Questions</a></li>
</ul>
</li>
</ul>
<div class="clear"></div>
</div> 
</div>
<div class="right-menu">
<div class="toc-toggle">
<a href="javascript:void(0);"><i class="fa fa-bars"></i></a>
</div>
<div class="mobile-search-btn">
<a href="https://www.tutorialspoint.com/search.htm"><i class="fal fa-search"></i></a>
</div>
<div class="search-box">
<form method="get" class="" name="searchform" action="https://www.google.com/search" target="_blank" novalidate="">
<input type="hidden" name="sitesearch" value="www.tutorialspoint.com" class="user-valid valid">
<input class="header-search-box" type="text" id="search-string" name="q" placeholder="Search your favorite tutorials..." onfocus="if (this.value == 'Search your favorite tutorials...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search your favorite tutorials...';}" autocomplete="off">
<button><i class="fal fa-search"></i></button>
</form>
</div>
<div class="menu-btn library-btn">
<a href="https://www.tutorialspoint.com/tutorialslibrary.htm"><i class="fal fa-cubes"></i> <span>Library</span></a>
</div>
<div class="menu-btn videos-btn">
<a href="https://www.tutorialspoint.com/videotutorials/index.htm"><i class="fal fa-video"></i> <span>Videos</span></a> 
</div>
<div class="menu-btn videos-btn">
<a href="https://www.tutorialspoint.com/questions/index.php"><i class="fa fa-location-arrow"></i> <span>Q/A</span></a>
</div>
<div class="menu-btn ebooks-btn">
<a href="https://store.tutorialspoint.com"><i class="fal fa-book"></i> <span>eBooks</span></a>
</div>
<div class="mui-dropdown">
<button class="mui-btn mui-btn--primary" data-mui-toggle="dropdown">
<span class="mui-caret"></span>
</button>
<ul class="mui-dropdown__menu">
<li><a href="https://www.tutorialspoint.com/tutorialslibrary.htm"><i class="fal fa-cubes"></i> <span>Library</span></a></li>
<li><a href="https://www.tutorialspoint.com/videotutorials/index.htm"><i class="fal fa-video"></i> <span>Videos</span></a></li>
<li><a href="https://store.tutorialspoint.com"><i class="fal fa-book"></i> <span>eBooks</span></a></li>
</ul>
</div>
</div>
</div>
</div>
<!-- Top main-menu Ends Here -->
</header>
<div class="mui-container-fluid content">
<div class="mui-container">
<!-- Tutorial ToC Starts Here -->
<div class="mui-col-md-3 tutorial-toc">
<div class="mini-logo">
<img src="/ejb/images/ejb-mini-logo.jpg" alt="EJB Tutorial" />
</div>
<ul class="toc chapters">
<li class="heading">EJB Tutorial</li>
<li><a href="/ejb/index.htm">EJB - Home</a></li>
<li><a href="/ejb/ejb_overview.htm">EJB - Overview</a></li>
<li><a href="/ejb/ejb_environment.htm">EJB - Environment Setup</a></li>
<li><a href="/ejb/ejb_create_application.htm">EJB - Create Application</a></li>
<li><a href="/ejb/ejb_stateless_beans.htm">EJB - Stateless Bean</a></li>
<li><a href="/ejb/ejb_stateful_beans.htm">EJB - Stateful Bean</a></li>
<li><a href="/ejb/ejb_persistence.htm">EJB - Persistence</a></li>
<li><a href="/ejb/ejb_message_driven_beans.htm">EJB - Message Driven Beans</a></li>
<li><a href="/ejb/ejb_annotations.htm">EJB - Annotations</a></li>
<li><a href="/ejb/ejb_callbacks.htm">EJB - Callbacks</a></li>
<li><a href="/ejb/ejb_timer_service.htm">EJB - Timer Service</a></li>
<li><a href="/ejb/ejb_dependency_injection.htm">EJB - Dependency Injection</a></li>
<li><a href="/ejb/ejb_interceptors.htm">EJB - Interceptors</a></li>
<li><a href="/ejb/ejb_embeddable_objects.htm">EJB - Embeddable Objects</a></li>
<li><a href="/ejb/ejb_blobs_clobs.htm">EJB - Blobs/Clobs</a></li>
<li><a href="/ejb/ejb_transactions.htm">EJB - Transactions</a></li>
<li><a href="/ejb/ejb_security.htm">EJB - Security</a></li>
<li><a href="/ejb/ejb_jndi_bindings.htm">EJB - JNDI Bindings</a></li>
<li><a href="/ejb/ejb_entity_relationships.htm">EJB - Entity Relationships</a></li>
<li><a href="/ejb/ejb_access_database.htm">EJB - Access Database</a></li>
<li><a href="/ejb/ejb_query_language.htm">EJB - Query Language</a></li>
<li><a href="/ejb/ejb_exception_handling.htm">EJB - Exception Handling</a></li>
<li><a href="/ejb/ejb_web_services.htm">EJB - Web Services</a></li>
<li><a href="/ejb/ejb_packaging_applications.htm">EJB - Packaging Applications</a></li>
</ul>
<ul class="toc chapters">
<li class="heading">EJB Useful Resources</li>
<li><a href="/ejb/ejb_quick_guide.htm">EJB - Quick Guide</a></li>
<li><a href="/ejb/ejb_useful_resources.htm">EJB - Useful Resources</a></li>
<li><a href="/ejb/ejb_discussion.htm">EJB - Discussion</a></li>
</ul>
<ul class="toc reading">
<li class="sreading">Selected Reading</li>
<li><a target="_top" href="/upsc_ias_exams.htm">UPSC IAS Exams Notes</a></li>
<li><a target="_top" href="/developers_best_practices/index.htm">Developer's Best Practices</a></li>
<li><a target="_top" href="/questions_and_answers.htm">Questions and Answers</a></li>
<li><a target="_top" href="/effective_resume_writing.htm">Effective Resume Writing</a></li>
<li><a target="_top" href="/hr_interview_questions/index.htm">HR Interview Questions</a></li>
<li><a target="_top" href="/computer_glossary.htm">Computer Glossary</a></li>
<li><a target="_top" href="/computer_whoiswho.htm">Who is Who</a></li>
</ul>
</div>
<!-- Tutorial ToC Ends Here -->
<!-- Tutorial Content Starts Here -->
<div class="mui-col-md-6 tutorial-content">
<h1>EJB - Quick Guide</h1>
<hr />
<div class="top-ad-heading">Advertisements</div>
<div style="text-align: center;">
<script><!--
google_ad_client = "pub-7133395778201029";
var width = document.getElementsByClassName("tutorial-content")[0].clientWidth - 40;
google_ad_width = width;
google_ad_height = 150;
google_ad_format = width + "x150_as";
google_ad_type = "image";
google_ad_channel = "";
//--></script>
<script src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<div class="mui-container-fluid button-borders">
<div class="pre-btn">
<a href="/ejb/ejb_packaging_applications.htm"><i class="fal fa-chevron-circle-left"></i> Previous Page</a>
</div>
<div class="nxt-btn">
<a href="/ejb/ejb_useful_resources.htm">Next Page <i class="fal fa-chevron-circle-right"></i>&nbsp;</a>
</div>
</div>
<div class="clearer"></div>
<h1>EJB - Overview</h1>
<p>EJB stands for <b>Enterprise</b> <b>Java</b> <b>Beans</b>. EJB is an essential part of a J2EE platform. J2EE platform has component based architecture to provide multi-tiered, distributed and highly transactional features to enterprise level applications.</p>
<p>EJB provides an architecture to develop and deploy component based enterprise applications considering robustness, high scalability, and high performance. An EJB application can be deployed on any of the application server compliant with the J2EE 1.3 standard specification.</p>
<p>We'll be discussing EJB 3.0 in detail in this tutorial.</p>
<h2>Types</h2>
<p>EJB is primarily divided into three categories; following table lists their names with brief descriptions &minus;</p>
<table class="table table-bordered">
<tr>
<th>S.No</th>
<th style="text-align:center">Type &amp; Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td>
<p><b>Session Bean</b></p>
<p>Session bean stores data of a particular user for a single session. It can be <a href="/ejb/ejb_stateful_beans.htm"><b>stateful</b></a> or <a href="/ejb/ejb_stateless_beans.htm"><b>stateless</b></a>. It is less resource intensive as compared to entity bean. Session bean gets destroyed as soon as user session terminates.</p>
</td>
</tr>
<tr>
<td class="ts">2</td>
<td>
<p><b>Entity Bean</b></p>
<p><b><a href="/ejb/ejb_persistence.htm">Entity beans</a></b> represent persistent data storage. User data can be saved to database via entity beans and later on can be retrieved from the database in the entity bean.</p>
</td>
</tr>
<tr>
<td class="ts">3</td>
<td>
<p><b>Message Driven Bean</b></p>
<p><b><a href="/ejb/ejb_message_driven_beans.htm">Message driven beans</a></b> are used in context of JMS (Java Messaging Service). Message Driven Beans can consumes JMS messages from external entities and act accordingly.</p>
</td>
</tr>
</table>
<h2>Benefits</h2>
<p>Following are the important benefits of EJB &minus;</p>
<ul class="list">
<li><p>Simplified development of large-scale enterprise level application.</p></li>
<li><p>Application Server/EJB container provides most of the system level services like transaction handling, logging, load balancing, persistence mechanism, exception handling, and so on. Developer has to focus only on business logic of the application.</p></li>
<li><p>EJB container manages life cycle of EJB instances, thus developer needs not to worry about when to create/delete EJB objects.</p></li>
</ul>
<h1>EJB - Environment Setup</h1>
<p>EJB is a framework for Java, so the very first requirement is to have a <b>J</b>ava <b>D</b>evelopment <b>K</b>it (JDK) installed in your machine.</p>
<h2>System Requirement</h2>
<table class="table table-bordered" style="text-align:center; width:90%" align="center">
<tr>
<th style="text-align:center;">JDK</th>
<td>1.5 or above.</td>
</tr>
<tr>
<th style="text-align:center;">Memory</th>
<td>no minimum requirement.</td>
</tr>
<tr>
<th style="text-align:center;">Disk Space</th>
<td>no minimum requirement.</td>
</tr>
<tr>
<th style="text-align:center;">Operating System</th>
<td>no minimum requirement.</td>
</tr>
</table>
<h3>Step 1 - Verify Java Installation in Your System</h3>
<p>Now open console and execute the following <b>java</b> command.</p>
<table class="table table-bordered">
<tr>
<th style="width:20%; text-align:center;">OS</th>
<th style="text-align:center;">Task</th>
<th style="text-align:center;">Command</th>
</tr>
<tr>
<td class="ts">Windows</td>
<td>Open Command Console</td>
<td>c:\&gt; java -version</td>
</tr>
<tr>
<td class="ts">Linux</td>
<td>Open Command Terminal</td>
<td>$ java -version</td>
</tr>
<tr>
<td class="ts">Mac</td>
<td>Open Terminal</td>
<td>machine:~ joseph$ java -version</td>
</tr>
</table>
<p>Let's verify the output for all the operating systems &minus;</p>
<table class="table table-bordered">
<tr>
<th style="text-align:center; width:20%">OS</th>
<th style="text-align:center;">Output</th>
</tr>
<tr>
<td style="vertical-align:middle;">Windows</td>
<td>
<p>java version "1.6.0_21"</p> 
<p>Java(TM) SE Runtime Environment (build 1.6.0_21-b11)</p>
<p>Java HotSpot(TM) 64-Bit Server VM (build 23.21-b01, mixed mode)</p>
</td>
</tr>
<tr>
<td style="vertical-align:middle;">Linux</td>
<td>
<p>java version "1.6.0_21"</p>
<p>Java(TM) SE Runtime Environment (build 1.6.0_21-b11)</p>
<p>Java HotSpot(TM) 64-Bit Server VM (build 23.21-b01, mixed mode)</p>
</td>
</tr>
<tr>
<td style="vertical-align:middle;">Mac</td>
<td><p>java version "1.6.0_21"</p>
<p>Java(TM) SE Runtime Environment (build 1.6.0_21-b11)</p>
<p>Java HotSpot(TM) 64-Bit Server VM (build 23.21-b01, mixed mode)</p>
</td>
</tr>
</table>
<p>If you do not have Java installed, install the Java Software Development Kit (SDK) from <a target="_blank" rel="nofollow" href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">www.oracle.com</a>. We are assuming that Java 1.6.0_21 as installed version for this tutorial.</p>
<h3>Step 2 – Set JAVA Environment</h3>
<p>Set the <b>JAVA_HOME</b> environment variable to point the base directory location where Java is installed on your system. For example,</p>
<table class="table table-bordered">
<tr>
<th style="text-align:center; width:20%">OS</th>
<th style="text-align:center;">Output</th>
</tr>
<tr>
<td style="vertical-align:middle;">Windows</td>
<td>Set the environment variable JAVA_HOME to C:\Program Files\Java\jdk1.6.0_21</td>
</tr>
<tr>
<td>Linux</td>
<td>export JAVA_HOME=/usr/local/java-current</td>
</tr>
<tr>
<td>Mac</td>
<td>export JAVA_HOME=/Library/Java/Home</td>
</tr>
</table>
<p>Append Java compiler location to System Path.</p>
<table class="table table-bordered">
<tr>
<th style="text-align:center; width:20%">OS</th>
<th style="text-align:center;">Output</th>
</tr>
<tr>
<td style="vertical-align:middle;">Windows</td>
<td>Append the string ;C:\Program Files\Java\jdk1.6.0_21\bin to the end of the system variable, Path.</td>
</tr>
<tr>
<td>Linux</td>
<td>export PATH=$PATH:$JAVA_HOME/bin/</td>
</tr>
<tr>
<td>Mac</td>
<td>not required</td>
</tr>
</table>
<p>Verify Java Installation using <b>java -version</b> command explained above.</p>
<h3>Step 3 – Download and Install NetBeans IDE</h3>
<p>Download the latest version of NetBeans IDE  from <a rel="nofollow" target="_blank" rel="nofollow" href="https://netbeans.org/downloads/index.html">netbeans.org</a>. At the time of writing this tutorial, I downloaded <i>Netbeans 7.3</i> which comes bundled with JDK 1.7 using the following link <a target="_blank" rel="nofollow" href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">www.oracle.com</a></p>
<table class="table table-bordered" style="text-align:center;width:70%" align="center">
<tr>
<th style="text-align:center; width:20%">OS</th>
<th style="text-align:center;">Installer name</th>
</tr>
<tr>
<td>Windows</td>
<td>Netbeans 7.3</td>
</tr>
<tr>
<td>Linux</td>
<td>Netbeans 7.3</td>
</tr>
<tr>
<td>Mac</td>
<td>Netbeans 7.3</td>
</tr>
</table>
<h3>Step 4 – Setup JBoss Application Server</h3>
<p>You can download the latest version of JBoss Server from <a rel="nofollow" href="https://www.jboss.org/jbossas/downloads/" target="_blank">www.jboss.org</a>. Download the archive as per the platform. Extract the Jboss to any location on your machine.</p>
<table class="table table-bordered" style="text-align:center;width:70%" align="center">
<tr>
<th style="text-align:center; width:20%">OS</th>
<th style="text-align:center;">File name</th>
</tr>
<tr>
<td>Windows</td>
<td>jboss-5.1.0.GA-jdk6.zip</td>
</tr>
<tr>
<td>Linux</td>
<td>jboss-5.1.0.GA-src.tar.gz</td>
</tr>
<tr>
<td>Mac</td>
<td>jboss-5.1.0.GA-src.tar.gz</td>
</tr>
</table>
<h3>Step 5 - Configure JEE Plugins to Netbeans</h3>
<p>Open Plugin window using Tools &gt; Plugins. Open "Available Plugin" tab and select "Java EE Base" and "EJB and EAR" under "Java Web and EE" category. Click install button. Netbeans will download and install the respective plugins. Verify plugins installation using "Installed" tab (as shown in the image given below).</p>
<img src="/ejb/images/plugins.jpg" alt="Installed plugins" />
<h3>Step 6 - Configure JBoss Server in Netbeans</h3>
<p>Go to Services tab and right click on servers to add a new server.</p>
<img src="/ejb/images/server.jpg" alt="Add Server" />
<p>Add Server Instance wizard will open. Select JBoss and in next step enter the relevant details to configure server in netbeans.</p>
<img src="/ejb/images/choose_server.jpg" alt="Choose Server" />
<p>Once everything is configured, you will see the following screen.</p>
<img src="/ejb/images/servers.jpg" alt="Installed servers" />
<h3>Step 7 - Install Database Server (PostGreSql)</h3>
<p>Download latest version of PostGreSql database server  from <a target="_blank" rel="nofollow" href="https://www.postgresql.org/download/">www.postgresql.org</a>. At the time of writing this tutorial, I downloaded <i>PostGreSql 9.2</i></p>
<table class="table table-bordered" style="text-align:center;width:70%" align="center">
<tr>
<th style="text-align:center; width:20%">OS</th>
<th style="text-align:center;">Installer name</th>
</tr>
<tr>
<td>Windows</td>
<td>PostGreSql 9.2</td>
</tr>
<tr>
<td>Linux</td>
<td>PostGreSql 9.2</td>
</tr>
<tr>
<td>Mac</td>
<td>PostGreSql 9.2</td>
</tr>
</table>
<h1>EJB - Create Application</h1>
<p>To create a simple EJB module, we will use NetBeans, "New project" wizard. In the example given below, We will create an EJB module project named Component.</p>
<h2>Create Project</h2>
<p>In NetBeans IDE, select <b>File &gt; New Project &gt;</b>. You will see the following screen</p>
<img src="/ejb/images/new_project.jpg" alt="New Project Wizard step 1" />
<p>Select project type under category <b>Java EE</b>, Project type as <b>EJB Module</b>. Click <b>Next &gt;</b> button. You will see the following screen.</p>
<img src="/ejb/images/new_project1.jpg" alt="New Project Wizard step 2" />
<p>Enter project name and location. Click <b>Next &gt;</b> button. You will see the following screen.</p>
<img src="/ejb/images/new_project2.jpg" alt="New Project Wizard step 3" />
<p>Select Server as <b>JBoss Application Server</b>. Click <b>Finish</b> button. You will see the following project created by NetBeans.</p>
<img src="/ejb/images/project.jpg" alt="Project explorer" />
<h2>Create a Sample EJB</h2>
<p>To create a simple EJB, we will use NetBeans "New" wizard. In the example given below, We will create a stateless EJB class named librarySessionBean under EjbComponent project.</p>
<p>Select project EjbComponent in project explorer window and right click on it. Select, <b>New &gt; Session Bean</b>. You will see the <b>New Session Bean</b> wizard.</p>
<img src="/ejb/images/new_wizard.jpg" alt="New Session Bean Wizard" />
<p>Enter session bean name and package name. Click <b>Finish</b> button. You will see the following EJB classes created by NetBeans.</p>
<ul class="list">
<li><p><b>LibrarySessionBean</b> &minus; stateless session bean</p></li>
<li><p><b>LibrarySessionBeanLocal</b> &minus; local interface for session bean</p></li>
</ul>
<p>I am changing local interface to remote interface as we are going to access our EJB in a console based application. Remote/Local interface is used to expose business methods that an EJB has to implement.</p>
<p>LibrarySessionBeanLocal is renamed to LibrarySessionBeanRemote and LibrarySessionBean implements LibrarySessionBeanRemote interface.</p>
<h3>LibrarySessionBeanRemote</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;
 
import java.util.List;
import javax.ejb.Remote;
 
@Remote
public interface LibrarySessionBeanRemote {
   void addBook(String bookName);
   List getBooks();
}
</pre>
<h3>LibrarySessionBean</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;
 
import java.util.ArrayList;
import java.util.List;
import javax.ejb.Stateless;
 
@Stateless
public class LibrarySessionBean implements LibrarySessionBeanRemote {
   
   List&lt;String&gt; bookShelf;    
   
   public LibrarySessionBean() {
      bookShelf = new ArrayList&lt;String&gt;();
   }
    
   public void addBook(String bookName) {
      bookShelf.add(bookName);
   }    
 
   public List&lt;String&gt; getBooks() {
      return bookShelf;
   }
}
</pre>
<h2>Build the Project</h2>
<ul class="list">
<li>Select EjbComponent project in Project Explorer window.</li>
<li>Right click on it to open context menu.</li>
<li>Select clean and build.</li>
</ul>
<p>You will see the following output in NetBeans console output.</p>
<pre class="result notranslate" >
ant -f C:\\EJB\\EjbComponent clean dist
init:
undeploy-clean:
deps-clean:
Deleting directory C:\EJB\EjbComponent\build
Deleting directory C:\EJB\EjbComponent\dist
clean:
init:
deps-jar:
Created dir: C:\EJB\EjbComponent\build\classes
Copying 3 files to C:\EJB\EjbComponent\build\classes\META-INF
Created dir: C:\EJB\EjbComponent\build\empty
Created dir: C:\EJB\EjbComponent\build\generated-sources\ap-source-output
Compiling 2 source files to C:\EJB\EjbComponent\build\classes
warning: [options] bootstrap class path not set in conjunction with -source 1.6
Note: C:\EJB\EjbComponent\src\java\com\tutorialspoint\stateless
\LibraryPersistentBean.java uses unchecked or unsafe operations.
Note: Recompile with -Xlint:unchecked for details.
1 warning
compile:
library-inclusion-in-archive:
Created dir: C:\EJB\EjbComponent\dist
Building jar: C:\EJB\EjbComponent\dist\EjbComponent.jar
dist:
BUILD SUCCESSFUL (total time: 3 seconds)
</pre>
<h2>Start the Application Server</h2>
<ul class="list">
<li>Select JBoss application server under Servers in Services window.</li>
<li>Right click on it to open context menu.</li>
<li>Select start.</li>
</ul>
<p>You will see the following output in NetBeans, output under JBoss Application Server.</p>
<pre class="result notranslate" >
Calling C:\jboss-5.1.0.GA\bin\run.conf.bat
=========================================================================
 
   JBoss Bootstrap Environment
 
   JBOSS_HOME: C:\jboss-5.1.0.GA
 
   JAVA: C:\Program Files (x86)\Java\jdk1.6.0_21\bin\java
 
   JAVA_OPTS: -Dprogram.name=run.bat -Xms128m -Xmx512m -server
 
   CLASSPATH: C:\jboss-5.1.0.GA\bin\run.jar
 
=========================================================================
 
16:25:50,062 INFO  [ServerImpl] Starting JBoss (Microcontainer)...
16:25:50,062 INFO  [ServerImpl] Release ID: JBoss 
   [The Oracle] 5.1.0.GA (build: SVNTag=JBoss_5_1_0_GA date=200905221634)
...
 
16:26:40,420 INFO  [TomcatDeployment] deploy, ctxPath=/admin-console
16:26:40,485 INFO  [config] Initializing Mojarra (1.2_12-b01-FCS) for context '/admin-console'
16:26:42,362 INFO  [TomcatDeployment] deploy, ctxPath=/
16:26:42,406 INFO  [TomcatDeployment] deploy, ctxPath=/jmx-console
16:26:42,471 INFO  [Http11Protocol] Starting Coyote HTTP/1.1 on http-127.0.0.1-8080
16:26:42,487 INFO  [AjpProtocol] Starting Coyote AJP/1.3 on ajp-127.0.0.1-8009
16:26:42,493 INFO  [ServerImpl] JBoss (Microcontainer) 
   [5.1.0.GA (build: SVNTag=JBoss_5_1_0_GA date=200905221634)] Started in 52s:427ms
</pre>
<h2>Deploy the Project</h2>
<ul class="list">
<li>Select EjbComponent project in Project Explorer window.</li>
<li>Right click on it to open context menu.</li>
<li>Select Deploy.</li>
</ul>
<p>You will see the following output in NetBeans console output.</p>
<pre class="result notranslate" >
ant -f C:\\EJB\\EjbComponent -DforceRedeploy=true -Ddirectory.deployment.supported=false -Dnb.wait.for.caches=true run
init:
deps-jar:
compile:
library-inclusion-in-archive:
Building jar: C:\EJB\EjbComponent\dist\EjbComponent.jar
dist-directory-deploy:
pre-run-deploy:
Checking data source definitions for missing JDBC drivers...
Distributing C:\EJB\EjbComponent\dist\EjbComponent.jar to [org.jboss.deployment.spi.LocalhostTarget@1e4f84ee]
Deploying C:\EJB\EjbComponent\dist\EjbComponent.jar
Application Deployed
Operation start started
Operation start completed
post-run-deploy:
run-deploy:
run:
BUILD SUCCESSFUL (total time: 2 seconds)
</pre>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
16:30:00,963 INFO  [DeployHandler] Begin start, [EjbComponent.jar]
...
16:30:01,233 INFO  [Ejb3DependenciesDeployer] Encountered deployment AbstractVFSDeploymentContext@12038795{vfszip:/C:/jboss-5.1.0.GA/server/default/deploy/EjbComponent.jar/}
...
16:30:01,281 INFO  [JBossASKernel]    jndi:LibrarySessionBean/remote-com.tutorialspoint.stateless.LibrarySessionBeanRemote
16:30:01,281 INFO  [JBossASKernel]    Class:com.tutorialspoint.stateless.LibrarySessionBeanRemote
16:30:01,281 INFO  [JBossASKernel]    jndi:LibrarySessionBean/remote
16:30:01,281 INFO  [JBossASKernel]  Added bean(jboss.j2ee:jar=EjbComponent.jar,name=
LibrarySessionBean,service=EJB3) to KernelDeployment of: EjbComponent.jar
16:30:01,282 INFO  [JBossASKernel] installing bean: jboss.j2ee:jar=EjbComponent.jar,name=BookMessageHandler,service=EJB3
16:30:01,282 INFO  [JBossASKernel]   with dependencies:
16:30:01,282 INFO  [JBossASKernel]   and demands:
16:30:01,282 INFO  [JBossASKernel]    jboss.ejb:service=EJBTimerService
...
16:30:01,283 INFO  [EJB3EndpointDeployer] Deploy 
AbstractBeanMetaData@5497cb{name=jboss.j2ee:jar=EjbComponent.jar, 
name=LibrarySessionBean, service=EJB3_endpoint bean=org.jboss.ejb3.endpoint.deployers.impl.EndpointImpl properties=[container] constructor=null autowireCandidate=true}
...
16:30:01,394 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibrarySessionBean,service=EJB3
16:30:01,395 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibrarySessionBean ejbName: LibrarySessionBean
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibrarySessionBean/remote - EJB3.x Default Remote Business Interface
   LibrarySessionBean/remote-com.tutorialspoint.stateless.LibrarySessionBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibrarySessionBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibrarySessionBean ejbName: LibrarySessionBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
 
   LibrarySessionBean/remote - EJB3.x Default Remote Business Interface
   LibrarySessionBean/remote-com.tutorialspoint.stateless.LibrarySessionBeanRemote - EJB3.x Remote Business Interface
</pre>
<h2>Create Client to Access EJB</h2>
<ul class="list">
<li><p>In NetBeans IDE, select <b>File &gt; New Project &gt;</b>.</p></li>
<li><p>Select project type under category <b>Java</b>, Project type as <b>Java Application</b>. Click Next &gt; button</p></li>
<li><p>Enter project name and location. Click <b>Finish &gt;</b> button. We have chosen name as EjbTester.</p></li>
<li><p>Right click on project name in Project explorer window. Select <b>properties</b>.</p></li>
<li><p>Add EJB component project created earlier under libraries using <b>Add Project</b> button in <b>compile</b> tab.</p></li>
<li><p>Add jboss libraries using <b>Add jar/folder</b> button in <b>compile</b> tab. Jboss libraries can be located at &lt;jboss installation folder&gt;&gt; client folder.</p></li>
</ul> 
<p>Create jndi.properties under project say EjbTester.</p>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<p>Create package com.tutorialspoint.test and EJBTester.java class under it.</p>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
 
import com.tutorialspoint.stateless.LibrarySessionBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.naming.InitialContext;
import javax.naming.NamingException;
 
 
public class EJBTester {
   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   public static void main(String[] args) {
 
      EJBTester ejbTester = new EJBTester();
 
      ejbTester.testStatelessEjb();
   }
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   private void testStatelessEjb() {
      try {
         int choice = 1; 
         LibrarySessionBeanRemote libraryBean = 
         (LibrarySessionBeanRemote)ctx.lookup("LibrarySessionBean/remote");
         while (choice != 2) {
            String bookName;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();                    
               libraryBean.addBook(bookName);          
            }else if (choice == 2) {
               break;
            }
         }
         List&lt;String&gt; booksList = libraryBean.getBooks();
         System.out.println("Book(s) entered so far: " + booksList.size());
         for (int i = 0; i &lt; booksList.size(); ++i) {
            System.out.println((i+1)+". " + booksList.get(i));
         }
         LibrarySessionBeanRemote libraryBean1 = 
         (LibrarySessionBeanRemote)ctx.lookup("LibrarySessionBean/remote");
         List&lt;String&gt; booksList1 = libraryBean1.getBooks();
         System.out.println(
            "***Using second lookup to get library stateless object***");
         System.out.println(
            "Book(s) entered so far: " + booksList1.size());
         for (int i = 0; i &lt; booksList1.size(); ++i) {
            System.out.println((i+1)+". " + booksList1.get(i));
         }
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      } finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }  
}
</pre>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn Java
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. Learn Java
***Using second lookup to get library stateless object***
Book(s) entered so far: 0
BUILD SUCCESSFUL (total time: 13 seconds)
</pre>
<p>In the following chapters, we will cover multiple aspects of this complete EJB application.</p>
<h1>EJB - Stateless Bean</h1>
<p>A stateless session bean is a type of enterprise bean, which is normally used to perform independent operations. A stateless session bean as per its name does not have any associated client state, but it may preserve its instance state. EJB Container normally creates a pool of few stateless bean's objects and use these objects to process client's request. Because of pool, instance variable values are not guaranteed to be same across lookups/method calls.</p>
<h2>Steps to Create a Stateless EJB</h2>
<p>Following are the steps required to create a stateless EJB &minus;</p>
<ul class="list">
<li><p>Create a remote/local interface exposing the business methods.</p></li>
<li><p>This interface will be used by the EJB client application.</p></li>
<li><p>Use @Local annotation, if EJB client is in same environment where EJB session bean is to be deployed.</p></li>
<li><p>Use @Remote annotation, if EJB client is in different environment where EJB session bean is to be deployed.</p></li>
<li><p>Create a stateless session bean, implementing the above interface.</p></li>
<li><p>Use @Stateless annotation to signify it a stateless bean. EJB Container automatically creates the relevant configurations or interfaces required by reading this annotation during deployment.</p></li>
</ul>
<h3>Remote Interface</h3>
<pre class="prettyprint notranslate">
import javax.ejb.Remote;
 
@Remote
public interface LibrarySessionBeanRemote {
   //add business method declarations
}
</pre>
<h3>Stateless EJB</h3>
<pre class="prettyprint notranslate">
@Stateless
public class LibrarySessionBean implements LibrarySessionBeanRemote {
   //implement business method 
}
</pre>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test stateless EJB.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.stateless</i> as explained in the <i>EJB - Create Application</i> chapter. You can also use the project created in <i>EJB - Create Application</i> chapter as such for this chapter to understand stateless EJB concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>LibrarySessionBean.java</i> and <i>LibrarySessionBeanRemote</i> as explained in the <i>EJB - Create Application</i> chapter. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>LibrarySessionBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;
 
import java.util.List;
import javax.ejb.Remote;
 
@Remote
public interface LibrarySessionBeanRemote {
   void addBook(String bookName);
   List getBooks();
}
</pre>
<h3>LibrarySessionBean.java</h3>
<pre class="prettyprint notranslate">
 
package com.tutorialspoint.stateless;
 
import java.util.ArrayList;
import java.util.List;
import javax.ejb.Stateless;
 
@Stateless
public class LibrarySessionBean implements LibrarySessionBeanRemote {
    
   List&lt;String&gt; bookShelf;    
 
   public LibrarySessionBean() {
      bookShelf = new ArrayList&lt;String&gt;();
   }
 
   public void addBook(String bookName) {
      bookShelf.add(bookName);
   }    
 
   public List&lt;String&gt; getBooks() {
      return bookShelf;
   }
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean - <b>LibrarySessionBean/remote</b>.</p></li>
<li><p>We will be using this lookup string to get remote business object of type - <b>com.tutorialspoint.stateless.LibrarySessionBeanRemote</b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibrarySessionBean/remote - EJB3.x Default Remote Business Interface
   LibrarySessionBean/remote-com.tutorialspoint.stateless.LibrarySessionBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibrarySessionBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibrarySessionBeanRemote ejbName: LibrarySessionBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
 
   LibrarySessionBean/remote - EJB3.x Default Remote Business Interface
   LibrarySessionBean/remote-com.tutorialspoint.stateless.LibrarySessionBeanRemote - EJB3.x Remote Business Interface
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateful.LibrarySessionBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.naming.InitialContext;
import javax.naming.NamingException;
 
public class EJBTester {
 
   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {
 
      EJBTester ejbTester = new EJBTester();
 
      ejbTester.testStatelessEjb();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testStatelessEjb() {
 
      try {
         int choice = 1; 
 
         LibrarySessionBeanRemote libraryBean =
         LibrarySessionBeanRemote)ctx.lookup("LibrarySessionBean/remote");
 
         while (choice != 2) {
            String bookName;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               Book book = new Book();
               book.setName(bookName);
               libraryBean.addBook(book);          
            } else if (choice == 2) {
               break;
            }
         }
 
         List&lt;Book&gt; booksList = libraryBean.getBooks();
 
         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            i++;
         }       
         LibrarySessionBeanRemote libraryBean1 = 
            (LibrarySessionBeanRemote)ctx.lookup("LibrarySessionBean/remote");
         List&lt;String&gt; booksList1 = libraryBean1.getBooks();
         System.out.println(
            "***Using second lookup to get library stateless object***");
         System.out.println(
            "Book(s) entered so far: " + booksList1.size());
         for (int i = 0; i &lt; booksList1.size(); ++i) {
            System.out.println((i+1)+". " + booksList1.get(i));
         }		 
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testStatelessEjb() method, jndi lookup is done with name - "LibrarySessionBean/remote" to obtain the remote business object (stateless ejb).</p></li>
<li><p>Then user is shown a library store User Interface and he/she is asked to enter choice.</p></li>
<li><p>If user enters 1, the system asks for book name and saves the book using stateless session bean addBook() method. Session Bean is storing the book in its instance variable.</p></li>
<li><p>If user enters 2, system retrieves books using stateless session bean getBooks() method and exits.</p></li>
<li><p>Then another jndi lookup is done with the name - "LibrarySessionBean/remote" to obtain the remote business object (stateless EJB) again and listing of books is done.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn Java
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. Learn Java
***Using second lookup to get library stateless object***
Book(s) entered so far: 0
BUILD SUCCESSFUL (total time: 13 seconds)
</pre>
<h2>Run Client Again to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 0
***Using second lookup to get library stateless object***
Book(s) entered so far: 1
1. Learn Java
BUILD SUCCESSFUL (total time: 12 seconds)
</pre>
<ul class="list">
<li><p>Output shown above may vary, depending upon how many stateless EJB object JBoss is maintaining.</p></li>
<li><p>In case, a single stateless EJB object is maintained, you may see the same list of books after each lookup.</p></li>
<li><p>EJB Container may return the same stateless EJB object for every lookup.</p></li>
<li><p>Stateless EJB bean is keeping value of instance variable till the server is not restarted.</p></li>
</ul>
<h1>EJB - Stateful Bean</h1>
<p>A stateful session bean is a type of enterprise bean, which preserve the conversational state with client. A stateful session bean as per its name keeps associated client state in its instance variables. EJB Container creates a separate stateful session bean to process client's each request. As soon as request scope is over, statelful session bean is destroyed.</p>
<h2>Steps to Create Stateful EJB</h2>
<p>Following are the steps required to create a stateful EJB &minus;</p>
<ul class="list">
<li><p>Create a remote/local interface exposing the business methods.</p></li>
<li><p>This interface will be used by the EJB client application.</p></li>
<li><p>Use @Local annotation if EJB client is in same environment where EJB session bean need to be deployed.</p></li>
<li><p>Use @Remote annotation if EJB client is in different environment where EJB session bean need to be deployed.</p></li>
<li><p>Create a stateful session bean, implementing the above interface.</p></li>
<li><p>Use @Stateful annotation to signify it a stateful bean. EJB Container automatically creates the relevant configurations or interfaces required by reading this annotation during deployment.</p></li>
</ul>
<h3>Remote Interface</h3>
<pre class="prettyprint notranslate">
import javax.ejb.Remote;
 
@Remote
public interface LibraryStatefulSessionBeanRemote {
   //add business method declarations
}
</pre>
<h3>Stateful EJB</h3>
<pre class="prettyprint notranslate">
@Stateful
public class LibraryStatefulSessionBean implements LibraryStatefulSessionBeanRemote {
   //implement business method 
}
</pre>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test stateful EJB.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.stateful</i> as explained in the <i>EJB &minus; Create Application</i> chapter. You can also use the project created in <i>EJB - Create Application</i> chapter as such for this chapter to understand stateful EJB concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>LibraryStatefulSessionBean.java</i> and <i>LibraryStatefulSessionBeanRemote</i> as explained in the <i>EJB &minus; Create Application</i> chapter. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>LibraryStatefulSessionBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateful;
 
import java.util.List;
import javax.ejb.Remote;
 
@Remote
public interface LibraryStatefulSessionBeanRemote {
   void addBook(String bookName);
   List getBooks();
}
</pre>
<h3>LibraryStatefulSessionBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateful;
 
import java.util.ArrayList;
import java.util.List;
import javax.ejb.Stateful;
 
@Stateful
public class LibraryStatefulSessionBean implements LibraryStatefulSessionBeanRemote {
    
   List&lt;String&gt; bookShelf;    
 
   public LibraryStatefulSessionBean() {
      bookShelf = new ArrayList&lt;String&gt;();
   }
 
   public void addBook(String bookName) {
      bookShelf.add(bookName);
   }    
 
   public List&lt;String&gt; getBooks() {
      return bookShelf;
   }
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean &minus; <b>LibraryStatefulSessionBean/remote</b>.</p></li>
<li><p>We will be using this lookup string to get remote business object of type  &minus;<b> com.tutorialspoint.stateful.LibraryStatefulSessionBeanRemote </b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibraryStatefulSessionBean/remote - EJB3.x Default Remote Business Interface
   LibraryStatefulSessionBean/remote-com.tutorialspoint.stateful.LibraryStatefulSessionBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibraryStatefulSessionBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateful.LibraryStatefulSessionBeanRemote ejbName: LibraryStatefulSessionBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
 
   LibraryStatefulSessionBean/remote - EJB3.x Default Remote Business Interface
   LibraryStatefulSessionBean/remote-com.tutorialspoint.stateful.LibraryStatefulSessionBeanRemote - EJB3.x Remote Business Interface
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial = org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs = org.jboss.naming:org.jnp.interfaces
java.naming.provider.url = localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateful session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateful.LibraryStatefulSessionBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.naming.InitialContext;
import javax.naming.NamingException;
 
public class EJBTester {
 
   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {
 
      EJBTester ejbTester = new EJBTester();
 
      ejbTester.testStatelessEjb();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testStatelessEjb() {
 
      try {
         int choice = 1; 
 
         LibraryStatefulSessionBeanRemote libraryBean =
         LibraryStatefulSessionBeanRemote)ctx.lookup("LibraryStatefulSessionBean/remote");
 
         while (choice != 2) {
            String bookName;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               Book book = new Book();
               book.setName(bookName);
               libraryBean.addBook(book);          
            } else if (choice == 2) {
               break;
            }
         }
 
         List&lt;Book&gt; booksList = libraryBean.getBooks();
 
         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            i++;
         }       
         LibraryStatefulSessionBeanRemote libraryBean1 = 
            (LibraryStatefulSessionBeanRemote)ctx.lookup("LibraryStatefulSessionBean/remote");
         List&lt;String&gt; booksList1 = libraryBean1.getBooks();
         System.out.println(
            "***Using second lookup to get library stateful object***");
         System.out.println(
            "Book(s) entered so far: " + booksList1.size());
         for (int i = 0; i &lt; booksList1.size(); ++i) {
            System.out.println((i+1)+". " + booksList1.get(i));
         }		 
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testStatefulEjb() method, jndi lookup is done with name - "LibraryStatefulSessionBean/remote" to obtain the remote business object (stateful ejb).</p></li>
<li><p>Then the user is shown a library store User Interface and he/she is asked to enter a choice.</p></li>
<li><p>If user enters 1, system asks for book name and saves the book using stateful session bean addBook() method. Session Bean is storing the book in its instance variable.</p></li>
<li><p>If user enters 2, system retrieves books using stateful session bean getBooks() method and exits.</p></li>
<li><p>Then another jndi lookup is done with the name - "LibraryStatefulSessionBean/remote" to obtain the remote business object (stateful EJB) again and listing of books is done.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console &minus;</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn Java
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. Learn Java
***Using second lookup to get library stateful object***
Book(s) entered so far: 0
BUILD SUCCESSFUL (total time: 13 seconds)
</pre>
<h2>Run Client Again to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 0
***Using second lookup to get library stateful object***
Book(s) entered so far: 0
BUILD SUCCESSFUL (total time: 12 seconds)
</pre>
<ul class="list">
<li><p>Output shown above states that for each lookup, a different stateful EJB instance
is returned.</p></li>
<li><p>Stateful EJB object is keeping value for single session only. As in second run, we
are not getting any value of books.</p></li>
</ul>
<h1>EJB - Persistence</h1>
<p>EJB 3.0, entity bean used in EJB 2.0 is largely replaced by persistence mechanism. Now entity bean is a simple POJO having mapping with table.</p>
<p>Following are the key actors in persistence API &minus;</p>
<ul class="list">
<li><p><b>Entity</b> &minus; A persistent object representing the data-store record. It is good to be serializable.</p></li>
<li><p><b>EntityManager</b> &minus; Persistence interface to do data operations like add/delete/update/find on persistent object(entity). It also helps to execute queries using <b>Query</b> interface.</p><li>
<li><p><b>Persistence unit (persistence.xml)</b> &minus; Persistence unit describes the properties of persistence mechanism.</p><li>
<li><p><b>Data Source (*ds.xml)</b> &minus; Data Source describes the data-store related properties like connection url. user-name,password etc.</p></li>
</ul>
<p>To demonstrate EJB persistence mechanism, we need to do the following tasks &minus;</p>
<ul class="list">
<li><p><b>Step 1</b> &minus; Create table in database.</p></li>
<li><p><b>Step 2</b> &minus; Create Entity class corresponding to table.</p></li>
<li><p><b>Step 3</b> &minus; Create Data Source and Persistence Unit.</p></li>
<li><p><b>Step 4</b> &minus; Create a stateless EJB having EntityManager instance.</p></li>
<li><p><b>Step 5</b> &minus; Update stateless EJB. Add methods to add records and get records from database via entity manager.</p></li>
<li><p><b>Step 6</b> &minus; A console based application client will access the stateless EJB to persist data in database.</p></li>
</ul>
<h2>Create Table</h2>
<p>Create a table <b>books</b> in default database <b>postgres</b>.</p>
<pre class="prettyprint notranslate">
CREATE TABLE books (
   id     integer PRIMARY KEY,
   name   varchar(50)
);
</pre>
<h2>Create Entity class</h2>
<pre class="prettyprint notranslate">
//mark it entity using Entity annotation 
//map table name using Table annotation
@Entity
@Table(name="books")
public class Book implements Serializable{
    
   private int id;
   private String name;

   public Book() {        
   }

   //mark id as primary key with autogenerated value
   //map database column id with id field
   @Id
   @GeneratedValue(strategy= GenerationType.IDENTITY)
   @Column(name="id")
   public int getId() {
      return id;
   }
   ...
}
</pre>
<h2>Create DataSource and Persistence Unit</h2>
<h3>DataSource (jboss-ds.xml)</h3>
<pre class="prettyprint notranslate">
&lt;?xml version = "1.0" encoding = "UTF-8"?&gt;
&lt;datasources&gt;
   &lt;local-tx-datasource&gt;
      &lt;jndi-name&gt;PostgresDS&lt;/jndi-name&gt;
      &lt;connection-url&gt;jdbc:postgresql://localhost:5432/postgres&lt;/connection-url&gt;
      &lt;driver-class&gt;org.postgresql.driver&lt;/driver-class&gt;
      &lt;user-name&gt;sa&lt;/user-name&gt;
      &lt;password&gt;sa&lt;/password&gt;
      &lt;min-pool-size&gt;5&lt;/min-pool-size&gt;
      &lt;max-pool-size&gt;20&lt;/max-pool-size&gt;
      &lt;idle-timeout-minutes&gt;5&lt;/idle-timeout-minutes&gt;
   &lt;/local-tx-datasource&gt;
&lt;/datasources&gt;
</pre>
<h3>Persistence Unit (persistence.xml)</h3>
<pre class="prettyprint notranslate">
&lt;persistence version = "1.0" xmlns = "http://java.sun.com/xml/ns/persistence" xmlns:xsi = "http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;

   &lt;persistence-unit name = "EjbComponentPU" transaction-type = "JTA"&gt;
      &lt;jta-data-source&gt;java:/PostgresDS&lt;/jta-data-source&gt;
      &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
      &lt;properties/&gt;
   &lt;/persistence-unit&gt;
   
   &lt;persistence-unit name = "EjbComponentPU2" transaction-type = "JTA"&gt;
      &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
      &lt;jta-data-source&gt;java:/PostgresDS&lt;/jta-data-source&gt;
      &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
	  
      &lt;properties&gt;
         &lt;property name="hibernate.hbm2ddl.auto" value="update"/&gt;
      &lt;/properties&gt;
   &lt;/persistence-unit&gt;
   
&lt;/persistence&gt;
</pre>
<h2>Create Stateless EJB Having EntityManager Instance</h2>
<pre class="prettyprint notranslate">
@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
	
   //pass persistence unit to entityManager.
   @PersistenceContext(unitName="EjbComponentPU")
   private EntityManager entityManager;         

   public void addBook(Book book) {
      entityManager.persist(book);
   }    

   public List&lt;Book&gt; getBooks() {        
      return entityManager.createQuery("From Books").getResultList();
   }
   ...
}
</pre>
<p>After building the EJB module, we need a client to access the stateless bean, which we will be going to create in the next section.</p>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test EJB persistence mechanism.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.entity</i> as explained in the <i>EJB - Create Application</i> chapter. You can also use the project created in <i>EJB - Create Application</i> chapter as such for this chapter to understand EJB persistence concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>Book.java</i> under package <i>com.tutorialspoint.entity</i> and modify it as shown below.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Create <i>LibraryPersistentBean.java</i> and <i>LibraryPersistentBeanRemote</i> as explained in the <i>EJB - Create Application</i> chapters and modify them as shown below.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Create <i>jboss-ds.xml</i> in <b>EjbComponent &gt; setup </b> folder and <i>persistence.xml</i> in <b>EjbComponent &gt; src &gt; conf </b> folder.  These folders can be seen in files tab in Netbeans. Modify these files as shown above.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">6</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">7</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>. Modify it as shown below.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>Book.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.entity;

import java.io.Serializable;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.EntityListeners;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Table;

@Entity
@Table(name="books")
public class Book implements Serializable{
    
   private int id;
   private String name;

   public Book() {        
   }

   @Id
   @GeneratedValue(strategy= GenerationType.IDENTITY)
   @Column(name="id")
   public int getId() {
      return id;
   }

   public void setId(int id) {
      this.id = id;
   }

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }    
}
</pre>
<h3>LibraryPersistentBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Remote;

@Remote
public interface LibraryPersistentBeanRemote {

   void addBook(Book bookName);

   List&lt;Book&gt; getBooks();
    
}
</pre>
<h3>LibraryPersistentBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
    
   public LibraryPersistentBean() {
   }

   @PersistenceContext(unitName="EjbComponentPU")
   private EntityManager entityManager;         

   public void addBook(Book book) {
      entityManager.persist(book);
   }    

   public List&lt;Book&gt; getBooks() {
      return entityManager.createQuery("From Book").getResultList();
   }
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean - <b>LibraryPersistentBean/remote</b>.</p></li>
<li><p>We will be using this lookup string to get remote business object of type - <b>com.tutorialspoint.stateless.LibraryPersistentBeanRemote</b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.stateless.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibraryPersistentBeanRemote,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibraryPersistentBeanRemote ejbName: LibraryPersistentBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.stateless.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateless.LibraryPersistentBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.naming.InitialContext;
import javax.naming.NamingException;

public class EJBTester {

   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {

      EJBTester ejbTester = new EJBTester();

      ejbTester.testEntityEjb();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testEntityEjb() {

      try {
         int choice = 1; 

         LibraryPersistentBeanRemote libraryBean =
         LibraryPersistentBeanRemote)ctx.lookup("LibraryPersistentBean/remote");

         while (choice != 2) {
            String bookName;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               Book book = new Book();
               book.setName(bookName);
               libraryBean.addBook(book);          
            } else if (choice == 2) {
               break;
            }
         }

         List&lt;Book&gt; booksList = libraryBean.getBooks();

         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            i++;
         }           
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }
}
</pre>
<p>EJBTester performs the following tasks.</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testStatefulEjb() method, jndi lookup is done with name - "LibraryStatefulSessionBean/remote" to obtain the remote business object (stateful ejb).</p></li>
<li><p>Then user is shown a library store User Interface and he/she is asked to enter choice.</p></li>
<li><p>If user enters 1, system asks for book name and saves the book using stateless session bean addBook() method. Session Bean is persisting the book in database via EntityManager call.</p></li>
<li><p>If user enters 2, system retrieves books using stateful session bean getBooks() method and exits.</p></li>
<li><p>Then another jndi lookup is done with name - "LibraryStatelessSessionBean/remote" to obtain the remote business object (stateless EJB) again and listing of books is done.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console &minus;</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn Java
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. learn java
BUILD SUCCESSFUL (total time: 15 seconds)
</pre>
<h2>Run Client Again to Access EJB</h2>
<p>Restart the JBoss before accessing the EJB.</p>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn Spring
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 2
1. learn java
2. Learn Spring
BUILD SUCCESSFUL (total time: 15 seconds)
</pre>
<p>The output shown above states that books are getting stored in persistent storage and are retrieved from database.</p>
<h1>EJB - Message Driven Beans</h1>
<p>A message driven bean is a type of enterprise bean, which is invoked by EJB container when it receives a message from queue or topic. Message driven bean is a stateless bean and is used to do task asynchronously.</p>
<p>To demonstrate use of message driven bean, we will make use of EJB-persistence chapter and we need to do the following tasks &minus;</p>
<ul class="list">
<li><p><b>Step 1</b> &minus; Create table in database (Refer to <i>EJB-Persistence</i> chapter).</p></li>
<li><p><b>Step 2</b> &minus; Create Entity class corresponding to table (Refer to <i>EJB-Persistence</i> chapter).</p></li>
<li><p><b>Step 3</b> &minus; Create DataSource and Persistence Unit (Refer to <i>EJB-Persistence</i> chapter).</p></li>
<li><p><b>Step 4</b> &minus; Create a stateless EJB having EntityManager instance (Refer to <i>EJB-Persistence</i> chapter).</p></li>
<li><p><b>Step 5</b> &minus; Update stateless ejb.Add methods to add records and get records from database via entity manager (Refer to <i>EJB-Persistence</i> chapter).</p></li>
<li><p><b>Step 6</b> &minus; Create a Queue named <b>BookQueue</b> in JBoss <b>default</b> application directory.</p></li>
<li><p><b>Step 7</b> &minus; A console based application client will send message to this queue.</p></li>
<li><p><b>Step 8</b> &minus; Create a Message driven bean, which will use the stateless bean to persist the client data.</p></li>
<li><p><b>Step 9</b> &minus; EJB Container of jboss will call the above message driven bean and pass it the message that client will be sending to.</p></li>
</ul>
<h2>Create Queue</h2>
<p>Create a file named jbossmq-destinations-service.xml if not exists in <b>&lt;JBoss Installation Folder&gt; &gt; server &gt; default &gt; deploy </b> folder.</p>
<p>Here we are creating a queue named BookQueue &minus;</p>
<p>jbossmq-destinations-service.xml</p>
<pre class="prettyprint notranslate">
&lt;mbean code="org.jboss.mq.server.jmx.Queue"  
   name="jboss.mq.destination:service=Queue,name=BookQueue"&gt;  
   &lt;depends optional-attribute-name="DestinationManager"&gt;
      jboss.mq:service=DestinationManager
   &lt;/depends&gt;  
&lt;/mbean&gt;  
</pre>
<p>When you start the JBoss, you will see a similar entry in jboss log.</p>
<pre class="prettyprint notranslate">
...
10:37:06,167 INFO  [QueueService] Queue[/queue/BookQueue] started, fullSize=200000, pageSize=2000, downCacheSize=2000
...
</pre>
<h2>Create Message Driven Bean</h2>
<pre class="prettyprint notranslate">
@MessageDriven(
   name = "BookMessageHandler",
   activationConfig = {
      @ActivationConfigProperty( propertyName = "destinationType", 
                                 propertyValue = "javax.jms.Queue"),
      @ActivationConfigProperty( propertyName = "destination", 
                                 propertyValue ="/queue/BookQueue")
   }
)
public class LibraryMessageBean implements MessageListener {
 
   @Resource
   private MessageDrivenContext mdctx;  
 
   @EJB
   LibraryPersistentBeanRemote libraryBean;
 
   public LibraryMessageBean() {        
   }
 
   public void onMessage(Message message) {
   }
}
</pre>
<ul class="list">
<li><p>LibraryMessageBean is annotated with @MessageDriven annotation to mark it as message driven bean.</p></li>
<li><p>Its properties are defined as destinationType - Queue and destination - /queue/BookQueue.</p></li> 
<li><p>It implements MessageListener interface, which exposes onMessage method.</p></li> 
<li><p>It has MessgeDrivenContext as a resource.</p></li> 
<li><p>LibraryPersistentBeanRemote stateless bean is injected in this bean for persistence purpose.</p></li> 
</ul>
<p>Build the EjbComponent project and deploy it on JBoss. After building and deploying the EJB module, we need a client to send a message to jboss queue.</p>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test Message Driven Bean.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.entity</i> as explained in the <i>EJB - Create Application</i> chapter. You can also use the project created in <i>EJB - Create Application</i> chapter as such for this chapter to understand EJB persistence concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>Book.java</i> under package <i>com.tutorialspoint.entity</i> as created in <i>EJB-Persistence</i> chapter.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Create <i>LibraryPersistentBean.java</i> and <i>LibraryPersistentBeanRemote</i> as created in <i>EJB-Persistence</i> chapter.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Create <i>jboss-ds.xml</i> in <b>EjbComponent &gt; setup </b> folder and <i>persistence.xml</i> in <b>EjbComponent &gt; src &gt; conf </b> folder.  These folders can be seen in files tab in Netbeans as created in <i>EJB-Persistence</i> chapter.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Create <i>LibraryMessageBean.java</i> under a package <i>com.tutorialspoint.messagebean</i> and modify it as shown below.</p></td>
</tr>
<tr>
<td class="ts">6</td>
<td><p>Create <i>BookQueue</i> queue in Jboss as described above.</p></td>
</tr>
<tr>
<td class="ts">7</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">8</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">9</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>. Modify it as shown below.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>LibraryMessageBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.messagebean;
 
import com.tutorialspoint.entity.Book;
import com.tutorialspoint.stateless.LibraryPersistentBeanRemote;
import javax.annotation.Resource;
import javax.ejb.ActivationConfigProperty;
import javax.ejb.EJB;
import javax.ejb.MessageDriven;
import javax.ejb.MessageDrivenContext;
import javax.jms.JMSException;
import javax.jms.Message;
import javax.jms.MessageListener;
import javax.jms.ObjectMessage;
 
@MessageDriven(
   name = "BookMessageHandler",
   activationConfig = {
      @ActivationConfigProperty( propertyName = "destinationType", 
                                 propertyValue = "javax.jms.Queue"),
      @ActivationConfigProperty( propertyName = "destination", 
                                 propertyValue ="/queue/BookQueue")
   }
)
public class LibraryMessageBean implements MessageListener {
 
   @Resource
   private MessageDrivenContext mdctx;  
 
   @EJB
   LibraryPersistentBeanRemote libraryBean;
 
   public LibraryMessageBean() {        
   }
 
   public void onMessage(Message message) {
      ObjectMessage objectMessage = null;
      try {
         objectMessage = (ObjectMessage) message;
         Book book = (Book) objectMessage.getObject(); 
         libraryBean.addBook(book);
 
      } catch (JMSException ex) {
         mdctx.setRollbackOnly();
      }       
   }   
}
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.entity.Book;
import com.tutorialspoint.stateless.LibraryPersistentBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.jms.ObjectMessage;
import javax.jms.Queue;
import javax.jms.QueueConnection;
import javax.jms.QueueConnectionFactory;
import javax.jms.QueueSender;
import javax.jms.QueueSession;
import javax.naming.InitialContext;
import javax.naming.NamingException;
 
public class EJBTester {
 
   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {
 
      EJBTester ejbTester = new EJBTester();
 
      ejbTester.testMessageBeanEjb();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testMessageBeanEjb() {
 
      try {
         int choice = 1; 
         Queue queue = (Queue) ctx.lookup("/queue/BookQueue");
         QueueConnectionFactory factory =
         (QueueConnectionFactory) ctx.lookup("ConnectionFactory");
         QueueConnection connection =  factory.createQueueConnection();
         QueueSession session = 
         connection.createQueueSession(false, QueueSession.AUTO_ACKNOWLEDGE);
         QueueSender sender = session.createSender(queue);
 
         while (choice != 2) {
            String bookName;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               Book book = new Book();
               book.setName(bookName);
               ObjectMessage objectMessage = 
                  session.createObjectMessage(book);
               sender.send(objectMessage); 
            } else if (choice == 2) {
               break;
            }
         }
 
         LibraryPersistentBeanRemote libraryBean = 
         (LibraryPersistentBeanRemote)
         ctx.lookup("LibraryPersistentBean/remote");
 
         List&lt;Book&gt; booksList = libraryBean.getBooks();
 
         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            i++;
         }           
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }   
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testStatefulEjb() method, jndi lookup is done with the name - "/queue/BookQueue" to obtain treference of queue available in Jboss. Then sender is created using queue session.</p></li>
<li><p>Then user is shown a library store User Interface and he/she is asked to enter choice.</p></li>
<li><p>If user enters 1, the system asks for book name and sender sends the book name to queue. When JBoss container receives this message in queue, it calls our message driven bean's onMessage method. Our message driven bean then saves book using stateful session bean addBook() method. Session Bean is persisting the book in database via EntityManager call.</p></li>
<li><p>If user enters 2, then another jndi lookup is done with name - "LibraryStatefulSessionBean/remote" to obtain the remote business object (stateful EJB) again and listing of books is done.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console &minus;</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn EJB
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 2
1. learn java
1. learn EJB
BUILD SUCCESSFUL (total time: 15 seconds)
</pre>
<p>The output shown above states that our Message driven bean is receiving the message and storing the book in persistent storage and books are retrieved from the database.</p>
<h1>EJB - Annotations</h1>
<p>Annotations were introduced in Java 5.0. The purpose of having annotations is to attach additional information in the class or a meta-data of a class within its source code. In EJB 3.0, annotations are used to describe configuration meta-data in EJB classes. By this way, EJB 3.0 eliminates the need to describe configuration data in configuration XML files.</p>
<p>EJB container uses compiler tool to generate required artifacts like interfaces, deployment descriptors by reading those annotations. Following is the list of commonly used annotations.</p>
<table class="table table-bordered" >
<tr>
<th>Sr.no</th>
<th style="text-align:center">Name</th>
<th style="text-align:center">Description</th>
</tr>
<tr>  
<td class="ts">1</td>
<td class="ts"><p>javax.ejb.Stateless</p></td>
<td><p>Specifies that a given EJB class is a stateless session bean.</p>
<p><b>Attributes</b></p>
<ul class="list">
<li><p><b>name</b> &minus; Used to specify name of the session bean.</p></li>
<li><p><b>mappedName</b> &minus; Used to specify the JNDI name of the session bean.</p></li>
<li><p><b>description</b> &minus; Used to provide description of the session bean.</p></li>
</ul>
</td>
</tr>
<tr>
<td class="ts">2</td>
<td class="ts"><p>javax.ejb.Stateful</p></td>
<td><p>Specifies that a given EJB class is a stateful session bean.</p>
<p><b>Attributes</b></p>
<ul class="list">
<li><p><b>name</b> &minus; Used to specify name of the session bean.</p></li>
<li><p><b>mappedName</b> &minus; Used to specify the JNDI name of the session bean.</p></li>
<li><p><b>description</b> &minus; Used to provide description of the session bean.</p></li>
</ul>
</td>
</tr>
<tr>
<td class="ts">3</td>
<td class="ts"><p>javax.ejb.MessageDrivenBean</p></td>
<td>
<p>Specifies that a given EJB class is a message driven bean.</p>
<p><b>Attributes</b></p>
<ul class="list">
<li><p><b>name</b> &minus; Used to specify name of the message driven bean.</p></li>
<li><p><b>messageListenerInterface</b> &minus; Used to specify message listener interface for the message driven bean.</p></li>
<li><p><b>activationConfig</b> &minus; Used to specify the configuration details of the message-driven bean in an operational environment of the message driven bean.</p></li>
<li><p><b>mappedName</b> &minus; Used to specify the JNDI name of the session bean.</p></li>
<li><p><b>description</b> &minus; Used to provide description of the session bean.</p></li>
</ul>
</td>
</tr>
<tr>
<td class="ts">4</td>
<td class="ts"><p>javax.ejb.EJB</p></td>
<td><p>Used to specify or inject a dependency as EJB instance into another EJB.</p>
<p><b>Attributes</b></p>
<ul class="list">
<li><p><b>name</b> &minus; Used to specify name, which will be used to locate the referenced bean in the environment.</p></li>
<li><p><b>beanInterface</b> &minus; Used to specify the interface type of the referenced bean.</p></li>
<li><p><b>beanName</b> &minus; Used to provide name of the referenced bean.</p></li>
<li><p><b>mappedName</b> &minus; Used to specify the JNDI name of the referenced bean.</p></li>
<li><p><b>description</b> &minus; Used to provide description of the referenced bean.</p></li>
</ul>
</td>
</tr>
<tr>
<td class="ts">5</td>
<td class="ts"><p>javax.ejb.Local</p></td>
<td><p>Used to specify Local interface(s) of a session bean. This local interface states the business methods of the session bean (which can be stateless or stateful).</p>
<p>This interface is used to expose the business methods to local clients, which are running in the same deployment/application as EJB.</p>
<p><b>Attributes</b></p>
<ul class="list">
<li><p><b>value</b> &minus; Used to specify the list of local interfaces as an array of interfaces.</p></li>
</ul>
</td>
</tr>
<tr>
<td class="ts">6</td>
<td class="ts"><p>javax.ejb.Remote</p></td>
<td><p>Used to specify Remote interface(s) of a session bean. This remote interface states the business methods of the session bean (which can be stateless or stateful).</p>
<p>This interface is used to expose the business methods to remote clients, which are running in different deployment/application as EJB.</p>
<p><b>Attributes</b></p>
<ul class="list">
<li><p><b>value</b> &minus; Used to specify the list of remote interfaces as an array of interfaces.</p></li>
</ul>
</td>
</tr>
<tr>
<td class="ts">7</td>
<td class="ts"><p>javax.ejb.Activation ConfigProperty</p>
</td>
<td><p>Used to specify properties required for a message driven bean. For example, end point, destination, message selector etc.</p>
<p>This annotation is passed as a parameter to activationConfig attribute of javax.ejb.MessageDrivenBean annotation.</p>
<p><b>Attributes</b></p>
<ul class="list">
<li><p><b>propertyName </b> &minus; name of the property.</p></li>
<li><p><b>propertyValue </b> &minus; value of the property.</p></li>
</ul>
</td>
</tr>
<tr>
<td class="ts">8</td>
<td class="ts"><p>javax.ejb.PostActivate</p></td>
<td><p>Used to specify callback method of EJB lifecycle. This method will be called when EJB container just activated/reactivated the bean instance.</p>
<p>This interface is used to expose the business methods to local clients, which are running in same deployment/application as EJB.</p>
</td>
</tr>
</table>
<h1>EJB - Callbacks</h1>
<p>Callback is a mechanism by which the life cycle of an enterprise bean can be intercepted. EJB 3.0 specification has specified callbacks for which callback handler methods are created. EJB Container calls these callbacks. We can define callback methods in the EJB class itself or in a separate class. EJB 3.0 has provided many annotations for callbacks.</p>
<p>Following is the list of callback annotations for stateless bean &minus;</p>
<table class="table table-bordered">
<tr>
<th style="text-align:center;">Annotation</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<th>@PostConstruct</th>
<td>Invoked when a bean is created for the first time.</td>
</tr>
<tr>
<th style="vertical-align:middle;">@PreDestroy</th>
<td>Invoked when a bean is removed from the bean pool or is destroyed.</td>
</tr>
</table>
<p>Following is the list of callback annotations for stateful bean &minus;</p>
<table class="table table-bordered">
<tr>
<th style="text-align:center;">Annotation</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<th>@PostConstruct</th>
<td>Invoked when a bean is created for the first time.</td>
</tr>
<tr>
<th style="vertical-align:middle;">@PreDestroy</th>
<td>Invoked when a bean is removed from the bean pool or is destroyed.</td>
</tr>
<tr>
<th>@PostActivate</th>
<td>Invoked when a bean is loaded to be used.</td>
</tr>
<tr>
<th>@PrePassivate</th>
<td>Invoked when a bean is put back to bean pool.</td>
</tr>
</table>
<p>Following is the list of callback annotations for message driven bean &minus;</p>
<table class="table table-bordered">
<tr>
<th style="text-align:center;">Annotation</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<th>@PostConstruct</th>
<td>Invoked when a bean is created for the first time.</td>
</tr>
<tr>
<th style="vertical-align:middle;">@PreDestroy</th>
<td>Invoked when a bean is removed from the bean pool or is destroyed.</td>
</tr>
</table>
<p>Following is the list of callback annotations for entity bean &minus;</p>
<table class="table table-bordered">
<tr>
<th style="text-align:center;">Annotation</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<th>@PrePersist</th>
<td>Invoked when an entity is created in database.</td>
</tr>
<tr>
<th>@PostPersist</th>
<td>Invoked after an entity is created in database.</td>
</tr>
<tr>
<th>@PreRemove</th>
<td>Invoked when an entity is deleted from the database.</td>
</tr>
<tr>
<th>@PostRemove</th>
<td>Invoked after an entity is deleted from the database.</td>
</tr>
<tr>
<th>@PreUpdate</th>
<td>Invoked before an entity is to be updated in the database.</td>
</tr>
<tr>
<th style="vertical-align:middle;">@PostLoad</th>
<td>Invoked when a record is fetched from database and loaded into the entity.</td>
</tr>
</table>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test various callbacks in EJB.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.stateless</i> as explained in the <i>EJB - Create Application</i> chapter. You can also use the project created in <i>EJB - Persistence</i> chapter as such for this chapter to add various callbacks to EJB.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>LibrarySessionBean.java</i> and <i>LibrarySessionBeanRemote</i> as explained in the <i>EJB - Create Application</i> chapter. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Use Beans created in the <i>EJB - Persistence</i> chapter. Add callback methods as shown below. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Create a java class <i>BookCallbackListener</i> under package <i>com.tutorialspoint.callback</i>. This class will demonstrates the separation of callback methods.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">6</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">7</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>BookCallbackListener.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.callback;

import javax.persistence.PrePersist;
import javax.persistence.PostLoad;
import javax.persistence.PostPersist;
import javax.persistence.PostRemove;
import javax.persistence.PostUpdate;
import javax.persistence.PreRemove;
import javax.persistence.PreUpdate;

import com.tutorialspoint.entity.Book;

public class BookCallbackListener {
    
   @PrePersist
   public void prePersist(Book book) {
      System.out.println("BookCallbackListener.prePersist:" 
         + "Book to be created with book id: "+book.getId());
   }

   @PostPersist
   public void postPersist(Object book) {
      System.out.println("BookCallbackListener.postPersist::"
         + "Book created with book id: "+((Book)book).getId());
   }

   @PreRemove
   public void preRemove(Book book) {
      System.out.println("BookCallbackListener.preRemove:"
         + " About to delete Book: " + book.getId());
   }

   @PostRemove
   public void postRemove(Book book) {
      System.out.println("BookCallbackListener.postRemove::"
         + " Deleted Book: " + book.getId());
   }

   @PreUpdate
   public void preUpdate(Book book) {
      System.out.println("BookCallbackListener.preUpdate::"
         + " About to update Book: " + book.getId());
   }

   @PostUpdate
   public void postUpdate(Book book) {
      System.out.println("BookCallbackListener.postUpdate::"
         + " Updated Book: " + book.getId());
   }

   @PostLoad
   public void postLoad(Book book) {
      System.out.println("BookCallbackListener.postLoad::"
         + " Loaded Book: " + book.getId());
   }
}
</pre>
<h3>Book.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.entity;
 
import java.io.Serializable;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.EntityListeners;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Table;
 
@Entity
@Table(name="books")
public class Book implements Serializable{
    
   private int id;
   private String name;
 
   public Book() {        
   }
 
   @Id
   @GeneratedValue(strategy= GenerationType.IDENTITY)
   @Column(name="id")
   public int getId() {
      return id;
   }
 
   public void setId(int id) {
      this.id = id;
   }
 
   public String getName() {
      return name;
   }
 
   public void setName(String name) {
      this.name = name;
   }    
}
</pre>
<h3>LibraryStatefulSessionBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateful;

import java.util.ArrayList;
import java.util.List;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

import javax.ejb.PostActivate;
import javax.ejb.PrePassivate;
import javax.ejb.Stateful;

@Stateful
public class LibraryStatefulSessionBean 
   implements LibraryStatefulSessionBeanRemote {
   List&lt;String&gt; bookShelf;    

   public LibraryStatefulSessionBean() {
      bookShelf = new ArrayList&lt;String&gt;();
   }

   public void addBook(String bookName) {
      bookShelf.add(bookName);
   }    

   public List&lt;String&gt; getBooks() {
      return bookShelf;
   }

   @PostConstruct
   public void postConstruct() {
      System.out.println("LibraryStatefulSessionBean.postConstruct::"
         + " bean created.");
   }

   @PreDestroy
   public void preDestroy() {
      System.out.println("LibraryStatefulSessionBean.preDestroy:"
         + " bean removed.");
   }

   @PostActivate
   public void postActivate() {
      System.out.println("LibraryStatefulSessionBean.postActivate:"
         + " bean activated.");
   }

   @PrePassivate
   public void prePassivate() {
      System.out.println("LibraryStatefulSessionBean.prePassivate:"
         + " bean passivated.");
   }    
}
</pre>
<h3>LibraryStatefulSessionBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateful;

import java.util.List;
import javax.ejb.Remote;

@Remote
public interface LibraryStatefulSessionBeanRemote {
   void addBook(String bookName);
   List getBooks();
}
</pre>
<h3>LibraryPersistentBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

@Stateless
public class LibraryPersistentBean 
   implements LibraryPersistentBeanRemote {
    
   public LibraryPersistentBean() {}

   @PersistenceContext(unitName="EntityEjbPU")
   private EntityManager entityManager;         

   public void addBook(Book book) {
      entityManager.persist(book);
   }    

   public List&lt;Book&gt; getBooks() {     
      return entityManager.createQuery("From Book")
         .getResultList();
   }

   @PostConstruct
   public void postConstruct() {
      System.out.println("postConstruct:: LibraryPersistentBean session bean"
         + " created with entity Manager object: ");
   }

   @PreDestroy
   public void preDestroy() {
      System.out.println("preDestroy: LibraryPersistentBean session"
      + " bean is removed ");
   }
}
</pre>
<h3>LibraryPersistentBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Remote;

@Remote
public interface LibraryPersistentBeanRemote {

   void addBook(Book bookName);

   List&lt;Book&gt; getBooks();
    
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean - <b>LibraryPersistentBean/remote</b>.</p></li>
<li><p>We will be using this lookup string to get remote business object of type -
<b>com.tutorialspoint.stateless.LibraryPersistentBeanRemote</b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.stateless.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibraryPersistentBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibrarySessionBeanRemote ejbName: LibraryPersistentBean
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateful.LibrarySessionBeanRemote;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;

import java.util.List;
import java.util.Properties;

import javax.naming.InitialContext;
import javax.naming.NamingException;

public class EJBTester {

   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {

      EJBTester ejbTester = new EJBTester();

      ejbTester.testEntityEjb();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testEntityEjb() {    
      try {
      int choice = 1; 

      LibraryPersistentBeanRemote libraryBean = 
      (LibraryPersistentBeanRemote)
      ctx.lookup("LibraryPersistentBean/remote");

      while (choice != 2) {
         String bookName;
         showGUI();
         String strChoice = brConsoleReader.readLine();
         choice = Integer.parseInt(strChoice);
         if (choice == 1) {
            System.out.print("Enter book name: ");
            bookName = brConsoleReader.readLine();
            Book book = new Book();
            book.setName(bookName);
            libraryBean.addBook(book);          
         } else if (choice == 2) {
            break;
         }
      }

      List&lt;Book&gt; booksList = libraryBean.getBooks();

      System.out.println("Book(s) entered so far: " + booksList.size());
      int i = 0;
      for (Book book:booksList) {
         System.out.println((i+1)+". " + book.getName());
         i++;
      }           

      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }    
   }    
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testStatelessEjb() method, jndi lookup is done with the name - "LibrarySessionBean/remote" to obtain the remote business object (stateless EJB).</p></li>
<li><p>Then user is shown a library store User Interface and he/she is asked to enter a choice.</p></li>
<li><p>If the user enters 1, the system asks for book name and saves the book using stateless session bean addBook() method. Session Bean is storing the book in the database.</p></li>
<li><p>If user enters 2, system retrieves books using stateless session bean getBooks() method and exits.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn Java
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. Learn Java
BUILD SUCCESSFUL (total time: 13 seconds)
</pre>
<h3>JBoss Application Server Log Output</h3>
<p>You can find the following callback entries in JBoss log</p>
<pre class="result notranslate">
14:08:34,293 INFO  [STDOUT] postConstruct:: LibraryPersistentBean session bean created with entity Manager object
...
16:39:09,484 INFO  [STDOUT] BookCallbackListener.prePersist:: Book to be created with book id: 0
16:39:09,531 INFO  [STDOUT] BookCallbackListener.postPersist:: Book created with book id: 1
16:39:09,900 INFO  [STDOUT] BookCallbackListener.postLoad:: Loaded Book: 1
...
</pre>
<h1>EJB - Timer Service</h1>
<p>Timer Service is a mechanism by which scheduled application can be build. For example, salary slip generation on the 1st of every month. EJB 3.0 specification has specified @Timeout annotation, which helps in programming the EJB service in a stateless or message driven bean. EJB Container calls the method, which is annotated by @Timeout.</p>
<p>EJB Timer Service is a service provided by EJB container, which helps to create timer and to schedule callback when timer expires.</p>
<h2>Steps to Create Timer</h2>
<p>Inject SessionContext in bean using @Resource annotation &minus;</p>
<pre class="prettyprint notranslate">
@Stateless
public class TimerSessionBean {

   @Resource
   private SessionContext context;
   ...
}
</pre>
<p>Use SessionContext object to get TimerService and to create timer. Pass time in milliseconds and message.</p>
<pre class="prettyprint notranslate">
public void createTimer(long duration) {
   context.getTimerService().createTimer(duration, "Hello World!");
}
</pre>
<h2>Steps to Use Timer</h2>
<p>Use @Timeout annotation to a method. Return type should be void and pass a parameter of type Timer. We are canceling the timer after first execution otherwise it will keep running after fix intervals.</p>
<pre class="prettyprint notranslate">
@Timeout
public void timeOutHandler(Timer timer) {
   System.out.println("timeoutHandler : " + timer.getInfo());        
   timer.cancel();
}
</pre>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test Timer Service in EJB.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.timer</i> as explained in the <i>EJB - Create Application</i> chapter.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>TimerSessionBean.java</i> and <i>TimerSessionBeanRemote</i> as explained in the <i>EJB - Create Application</i> chapter. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>TimerSessionBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.timer;

import javax.annotation.Resource;
import javax.ejb.SessionContext;
import javax.ejb.Timer;
import javax.ejb.Stateless;
import javax.ejb.Timeout;

@Stateless
public class TimerSessionBean implements TimerSessionBeanRemote {

   @Resource
   private SessionContext context;

   public void createTimer(long duration) {
      context.getTimerService().createTimer(duration, "Hello World!");
   }

   @Timeout
   public void timeOutHandler(Timer timer) {
      System.out.println("timeoutHandler : " + timer.getInfo());        
      timer.cancel();
   }
}
</pre>
<h3>TimerSessionBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.timer;

import javax.ejb.Remote;

@Remote
public interface TimerSessionBeanRemote {
   public void createTimer(long milliseconds);
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean &minus; <b>TimerSessionBean/remote</b>.</p></li>
<li><p>We will using this lookup string to get remote business object of type &minus;
<b> com.tutorialspoint.timer.TimerSessionBeanRemote  </b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   TimerSessionBean/remote - EJB3.x Default Remote Business Interface
   TimerSessionBean/remote-com.tutorialspoint.timer.TimerSessionBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=TimerSessionBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.timer.TimerSessionBeanRemote ejbName: TimerSessionBean
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateful.TimerSessionBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.naming.InitialContext;
import javax.naming.NamingException;

public class EJBTester {

   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {

      EJBTester ejbTester = new EJBTester();

      ejbTester.testTimerService();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testTimerService() {
      try {
         TimerSessionBeanRemote timerServiceBean = (TimerSessionBeanRemote)ctx.lookup("TimerSessionBean/remote");

         System.out.println("["+(new Date()).toString()+ "]" + "timer created.");
         timerServiceBean.createTimer(2000);            

      } catch (NamingException ex) {
         ex.printStackTrace();
      }
   }
}
</pre>
<p>EJBTester is doing the following tasks.</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testTimerService() method, jndi lookup is done with the name - "TimerSessionBean/remote" to obtain the remote business object (timer stateless EJB).</p></li>
<li><p>Then createTimer is invoked passing 2000 milliseconds as schedule time.</p></li>
<li><p>EJB Container calls the timeoutHandler method after 2 seconds.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
[Wed Jun 19 11:35:47 IST 2013]timer created.
BUILD SUCCESSFUL (total time: 0 seconds)
</pre>
<h3>JBoss Application Server Log Output</h3>
<p>You can find the following callback entries in JBoss log</p>
<pre class="result notranslate">
...
11:35:49,555 INFO  [STDOUT] timeoutHandler : Hello World!
...
</pre>
<h1>EJB - Dependency Injection</h1>
<p>EJB 3.0 specification provides annotations, which can be applied on fields or setter methods to inject dependencies. EJB Container uses the global JNDI registry to locate the dependency. Following annotations are used in EJB 3.0 for dependency injection.</p>
<ul class="list">
<li><p><b>@EJB</b> &minus; used to inject other EJB reference.</p></li>
<li><p><b>@Resource</b> &minus; used to inject datasource or singleton services like sessionContext, timerService etc.</p></li>
</ul>
<h2>Steps to Use @EJB</h2>
<p>@EJB can be used on fields or on methods in the following manner &minus;</p>
<pre class="prettyprint notranslate">
public class LibraryMessageBean implements MessageListener {
   //dependency injection on field. 
   @EJB
   LibraryPersistentBeanRemote libraryBean;
   ...
}
public class LibraryMessageBean implements MessageListener {
  
   LibraryPersistentBeanRemote libraryBean;
   
   //dependency injection on method. 
   @EJB(beanName="com.tutorialspoint.stateless.LibraryPersistentBean")
   public void setLibraryPersistentBean(
   LibraryPersistentBeanRemote libraryBean)
   {
      this.libraryBean = libraryBean;
   }
   ...
}
</pre>
<h2>Steps to use @Resource</h2>
<p>@Resource is normally used to inject EJB Container provided singletons.</p>
<pre class="prettyprint notranslate">
public class LibraryMessageBean implements MessageListener {
   @Resource
   private MessageDrivenContext mdctx;  
   ...
}
</pre>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test Dependency Injection Service in EJB.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.timer</i> as explained in the <i>EJB - Create Application</i> chapter.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Use Beans created in the <i>EJB - Message Driven Bean</i> chapter. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>LibraryMessageBean.java</h3>
<pre class="prettyprint notranslate">
package com.tuturialspoint.messagebean;
 
import com.tutorialspoint.entity.Book;
import com.tutorialspoint.stateless.LibraryPersistentBeanRemote;
import javax.annotation.Resource;
import javax.ejb.ActivationConfigProperty;
import javax.ejb.EJB;
import javax.ejb.MessageDriven;
import javax.ejb.MessageDrivenContext;
import javax.jms.JMSException;
import javax.jms.Message;
import javax.jms.MessageListener;
import javax.jms.ObjectMessage;
 
@MessageDriven(
   name = "BookMessageHandler",
   activationConfig = {
      @ActivationConfigProperty( propertyName = "destinationType", 
                                 propertyValue = "javax.jms.Queue"),
      @ActivationConfigProperty( propertyName = "destination", 
                                 propertyValue ="/queue/BookQueue")
   }
)
public class LibraryMessageBean implements MessageListener {
 
   @Resource
   private MessageDrivenContext mdctx;  
 
   @EJB
   LibraryPersistentBeanRemote libraryBean;
 
   public LibraryMessageBean() {        
   }
 
   public void onMessage(Message message) {
      ObjectMessage objectMessage = null;
      try {
         objectMessage = (ObjectMessage) message;
         Book book = (Book) objectMessage.getObject(); 
         libraryBean.addBook(book);
 
      }catch (JMSException ex) {
         mdctx.setRollbackOnly();
      }       
   }   
}
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.entity.Book;
import com.tutorialspoint.stateless.LibraryPersistentBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.jms.ObjectMessage;
import javax.jms.Queue;
import javax.jms.QueueConnection;
import javax.jms.QueueConnectionFactory;
import javax.jms.QueueSender;
import javax.jms.QueueSession;
import javax.naming.InitialContext;
import javax.naming.NamingException;
 
public class EJBTester {
 
   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {
 
      EJBTester ejbTester = new EJBTester();
 
      ejbTester.testMessageBeanEjb();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testMessageBeanEjb() {
 
      try {
         int choice = 1; 
         Queue queue = (Queue) ctx.lookup("/queue/BookQueue");
         QueueConnectionFactory factory =
         (QueueConnectionFactory) ctx.lookup("ConnectionFactory");
         QueueConnection connection =  factory.createQueueConnection();
         QueueSession session = connection.createQueueSession( 
         false, QueueSession.AUTO_ACKNOWLEDGE);
         QueueSender sender = session.createSender(queue);
 
         while (choice != 2) {
            String bookName;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               Book book = new Book();
               book.setName(bookName);
               ObjectMessage objectMessage = 
               session.createObjectMessage(book);
               sender.send(objectMessage); 
            } else if (choice == 2) {
               break;
            }
         }
 
         LibraryPersistentBeanRemote libraryBean = 
         (LibraryPersistentBeanRemote)
		 ctx.lookup("LibraryPersistentBean/remote");
 
         List&lt;Book&gt; booksList = libraryBean.getBooks();
 
         System.out.println("Book(s) entered so far: " 
         + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            i++;
         }           
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }   
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testStatefulEjb() method, jndi lookup is done with the name - "/queue/BookQueue" to obtain reference of queue available in Jboss. Then sender is created using queue session.</p></li>
<li><p>Then the user is shown a library store User Interface and he/she is asked to enter a choice.</p></li>
<li><p>If the user enters 1, the system asks for book name and sender sends the book name to queue. When JBoss container receives this message in queue, it calls our message driven bean's onMessage method. Our message driven bean then saves book using stateful session bean addBook() method. Session Bean is persisting the book in database via EntityManager call.</p></li>
<li><p>If the user enters 2, then another jndi lookup is done with the name - "LibraryStatefulSessionBean/remote" to obtain the remote business object (stateful EJB) again and listing of books is done.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn EJB
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 2
1. learn java
1. learn EJB
BUILD SUCCESSFUL (total time: 15 seconds)
</pre>
<p>The output shown above states that our Message driven bean is receiving the message and storing book in persistent storage and books are retrieved from database.</p>
<p>Our message driven bean is using LibraryPersistentBean injected into it using @EJB annotation and in case of exception, MessageDrivenContext, object is used to rollback the transaction.</p>
<h1>EJB - Interceptors</h1>
<p>EJB 3.0 provides specification to intercept business methods calls using methods annotated with @AroundInvoke annotation. An interceptor method is called by ejbContainer before business method call it is intercepting. Following is the example signature of an interceptor method</p>
<pre class="prettyprint notranslate">
@AroundInvoke
public Object methodInterceptor(InvocationContext ctx) throws Exception {
   System.out.println("*** Intercepting call to LibraryBean method: " 
   + ctx.getMethod().getName());
   return ctx.proceed();
}
</pre>
<p>Interceptor methods can be applied or bound at three levels.</p>
<ul class="list">
<li><p><b>Default</b> &minus; Default interceptor is invoked for every bean within deployment.Default interceptor can be applied only via xml (ejb-jar.xml).</p></li>
<li><p><b>Class</b> &minus; Class level interceptor is invoked for every method of the bean. Class level interceptor can be applied both by annotation of via xml(ejb-jar.xml).</p></li>
<li><p><b>Method</b>&minus;  Method level interceptor is invoked for a particular method of the bean. Method level interceptor can be applied both by annotation of via xml(ejb-jar.xml).</p></li>
</ul>
<p>We are discussing Class level interceptor here.</p>
<h3>Interceptor Class</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.interceptor;

import javax.interceptor.AroundInvoke;
import javax.interceptor.InvocationContext;

public class BusinessInterceptor {
   @AroundInvoke
   public Object methodInterceptor(InvocationContext ctx) throws Exception {
      System.out.println("*** Intercepting call to LibraryBean method: " 
      + ctx.getMethod().getName());
      return ctx.proceed();
   }
}
</pre>
<h3>Remote Interface</h3>
<pre class="prettyprint notranslate">
import javax.ejb.Remote;

@Remote
public interface LibraryBeanRemote {
   //add business method declarations
}
</pre>
<h3>Intercepted Stateless EJB</h3>
<pre class="prettyprint notranslate">
@Interceptors ({BusinessInterceptor.class})
@Stateless
public class LibraryBean implements LibraryBeanRemote {
   //implement business method 
}
</pre>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test intercepted stateless EJB.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.interceptor</i> as explained in the <i>EJB - Create Application</i> chapter. You can also use the project created in <i>EJB - Create Application</i> chapter as such for this chapter to understand intercepted EJB concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>LibraryBean.java</i> and <i>LibraryBeanRemote</i> under package <i>com.tutorialspoint.interceptor</i> as explained in the <i>EJB - Create Application</i> chapter. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Now create the ejb client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>LibraryBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.interceptor;

import java.util.List;
import javax.ejb.Remote;

@Remote
public interface LibraryBeanRemote {
   void addBook(String bookName);
   List getBooks();
}
</pre>
<h3>LibraryBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.interceptor;

import java.util.ArrayList;
import java.util.List;

import javax.ejb.Stateless;
import javax.interceptor.Interceptors;

@Interceptors ({BusinessInterceptor.class})
@Stateless
public class LibraryBean implements LibraryBeanRemote {
    
   List&lt;String&gt; bookShelf;    

   public LibraryBean() {
      bookShelf = new ArrayList&lt;String&gt;();
   }

   public void addBook(String bookName) {
      bookShelf.add(bookName);
   }    

   public List&lt;String&gt; getBooks() {
      return bookShelf;
   }   
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean &minus; <b>LibraryBean/remote</b>.</p></li>
<li><p>We will using this lookup string to get remote business object of type &minus;
<b>com.tutorialspoint.interceptor.LibraryBeanRemote</b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibraryBean/remote - EJB3.x Default Remote Business Interface
   LibraryBean/remote-com.tutorialspoint.interceptor.LibraryBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibraryBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.interceptor.LibraryBeanRemote ejbName: LibraryBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

   LibraryBean/remote - EJB3.x Default Remote Business Interface
   LibraryBean/remote-com.tutorialspoint.interceptor.LibraryBeanRemote - EJB3.x Remote Business Interface
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateful.LibraryBeanRemote;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;

import java.util.List;
import java.util.Properties;

import javax.naming.InitialContext;
import javax.naming.NamingException;

public class EJBTester {

   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {

      EJBTester ejbTester = new EJBTester();

      ejbTester.testInterceptedEjb();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testInterceptedEjb() {

      try {
         int choice = 1; 

         LibraryBeanRemote libraryBean =
         LibraryBeanRemote)ctx.lookup("LibraryBean/remote");

         while (choice != 2) {
            String bookName;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               Book book = new Book();
               book.setName(bookName);
               libraryBean.addBook(book);          
            } else if (choice == 2) {
               break;
            }
         }

         List&lt;Book&gt; booksList = libraryBean.getBooks();

         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            i++;
         }                
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testInterceptedEjb() method, jndi lookup is done with the name - "LibraryBean/remote" to obtain the remote business object (stateless EJB).</p></li>
<li><p>Then user is shown a library store User Interface and he/she is asked to enter a choice.</p></li>
<li><p>If the user enters 1, the system asks for book name and saves the book using stateless session bean addBook() method. Session Bean is storing the book in its instance variable.</p></li>
<li><p>If the user enters 2, the system retrieves books using stateless session bean getBooks() method and exits.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn Java
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. Learn Java
BUILD SUCCESSFUL (total time: 13 seconds)
</pre>
<h3>JBoss Application Server Log Output</h3>
<p>Verify the following output in JBoss Application server log output.</p>
<pre class="result notranslate">
....
09:55:40,741 INFO  [STDOUT] *** Intercepting call to LibraryBean method: addBook
09:55:43,661 INFO  [STDOUT] *** Intercepting call to LibraryBean method: getBooks
</pre>
<h1>EJB - Embeddable Objects</h1>
<p>EJB 3.0 provides option to embed JAVA POJO (Plain Old Java Object) into an entity bean and allows to map column names with the methods of the embedded POJO class. A java POJO to be embedded must be annotated as @Embeddable.</p>
<pre class="prettyprint notranslate">
@Embeddable
public class Publisher implements Serializable{
   private String name;
   private String address;
   ...
}
</pre>
<p>The above class can be embedded using @Embedded annotation.</p>
<pre class="prettyprint notranslate">
@Entity
public class Book implements Serializable{
   private int id;
   private String name;
   private Publisher publisher;
   ...
   @Embedded
   @AttributeOverrides({
      @AttributeOverride(name = "name", 
                      column = @Column(name = "PUBLISHER")),
      @AttributeOverride(name = "address", 
                      column = @Column(name = "PUBLISHER_ADDRESS"))
   })
   public Publisher getPublisher() {
      return publisher;
   }
   ...
}
</pre>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test embedded objects in EJB 3.0.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.entity</i> as explained in the <i>EJB - Create Application</i> chapter. Please use the project created in <i>EJB - Persistence</i> chapter as such for this chapter to understand embedded objects in EJB concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>Publisher.java</i>  under package <i>com.tutorialspoint.entity</i> as explained in the <i>EJB - Create Application</i> chapter. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Create <i>Book.java</i>  under package <i>com.tutorialspoint.entity</i>. Use <i>EJB - Persistence</i> chapter as reference. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Finally, deploy the application in the form of a jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">6</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>.</p></td>
</tr>
</table>
<h3>Create/Alter Book Table</h3>
<pre class="prettyprint notranslate">
CREATE TABLE book (
   id     integer PRIMARY KEY,
   name   varchar(50)
);
Alter table book add publisher varchar(100);
Alter table book add publisher_address varchar(200);
</pre>
<h2>EJBComponent (EJB Module)</h2>
<h3>Publisher.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.entity;

import java.io.Serializable;
import javax.persistence.Embeddable;

@Embeddable
public class Publisher implements Serializable{
    
   private String name;
   private String address;

   public Publisher() {}

   public Publisher(String name, String address) {
      this.name = name;
      this.address = address;
   }

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }

   public String getAddress() {
      return address;
   }

   public void setAddress(String address) {
      this.address = address;
   }

   public String toString() {
      return name + "," + address;
   }    
}
</pre>
<h3>Book.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.entity;

import com.tutorialspoint.callback.BookCallbackListener;
import java.io.Serializable;

import javax.persistence.AttributeOverride;
import javax.persistence.AttributeOverrides;
import javax.persistence.Column;
import javax.persistence.Embedded;
import javax.persistence.Entity;
import javax.persistence.EntityListeners;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Table;

@Entity
@Table(name="book")
public class Book implements Serializable{

   private int id;
   private String name;
   private Publisher publisher;

   public Book() {        
   }

   @Id
   @GeneratedValue(strategy= GenerationType.IDENTITY)
   @Column(name="id")
   public int getId() {
      return id;
   }

   public void setId(int id) {
      this.id = id;
   }

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }


   @Embedded
   @AttributeOverrides({
      @AttributeOverride(name = "name", 
         column = @Column(name = "PUBLISHER")),
      @AttributeOverride(name = "address", 
         column = @Column(name = "PUBLISHER_ADDRESS"))
   })
   public Publisher getPublisher() {
      return publisher;
   }

   public void setPublisher(Publisher publisher) {
      this.publisher = publisher;
   }    
}
</pre>
<h3>LibraryPersistentBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Remote;

@Remote
public interface LibraryPersistentBeanRemote {

   void addBook(Book bookName);

   List&lt;Book&gt; getBooks();
    
}
</pre>
<h3>LibraryPersistentBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Stateless;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
    
   public LibraryPersistentBean() {
   }

   @PersistenceContext(unitName="EjbComponentPU")
   private EntityManager entityManager;         

   public void addBook(Book book) {
      entityManager.persist(book);
   }    

   public List&lt;Book&gt; getBooks() {
      return entityManager.createQuery("From Book").getResultList();
   }
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean &minus; <b>LibraryPersistentBean/remote</b>.</p></li>
<li><p>We will be using this lookup string to get remote business object of type &minus;
<b>com.tutorialspoint.interceptor.LibraryPersistentBeanRemote</b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.interceptor.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibraryPersistentBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.interceptor.LibraryPersistentBeanRemote ejbName: LibraryPersistentBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.interceptor.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateful.LibraryBeanRemote;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;

import java.util.List;
import java.util.Properties;

import javax.naming.InitialContext;
import javax.naming.NamingException;

public class EJBTester {

   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {

      EJBTester ejbTester = new EJBTester();

      ejbTester.testEmbeddedObjects();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testEmbeddedObjects() {

      try {
         int choice = 1; 

         LibraryPersistentBeanRemote libraryBean = 
        (LibraryPersistentBeanRemote)
         ctx.lookup("LibraryPersistentBean/remote");

         while (choice != 2) {
            String bookName;
            String publisherName;
            String publisherAddress;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               System.out.print("Enter publisher name: ");
               publisherName = brConsoleReader.readLine();
               System.out.print("Enter publisher address: ");
               publisherAddress = brConsoleReader.readLine();
               Book book = new Book();
               book.setName(bookName);
               book.setPublisher
              (new Publisher(publisherName,publisherAddress));

               libraryBean.addBook(book);          
            } else if (choice == 2) {
               break;
            }
         }

         List&lt;Book&gt; booksList = libraryBean.getBooks();

         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            System.out.println("Publication: "+book.getPublisher());
            i++;
         }           
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testInterceptedEjb() method, jndi lookup is done with the name - "LibraryPersistenceBean/remote" to obtain the remote business object (stateless EJB).</p></li>
<li><p>Then the user is shown a library store User Interface and he/she is asked to enter a 
choice.</p></li>
<li><p>If the user enters 1,the system asks for book name and saves the book using stateless session bean addBook() method. Session Bean is storing the book in database.</p></li>
<li><p>If the user enters 2, the system retrieves books using stateless session bean getBooks() method and exits.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: learn html5
Enter publisher name: SAMS
Enter publisher address: DELHI
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. learn html5
Publication: SAMS,DELHI
BUILD SUCCESSFUL (total time: 21 seconds)
</pre>
<h1>EJB - Blobs/Clobs</h1>
<p>EJB 3.0 provides support for Blob and Clob types using @Lob annotation. Following java types can be mapped using @Lob annotation.</p>
<ul class="list">
<li>java.sql.Blob</li>
<li>java.sql.Clob</li>
<li>byte[]</li>
<li>String</li>
<li>Serializable Object</li>
</ul>
<pre class="prettyprint notranslate">
@Entity
@Table(name="books")
@EntityListeners(BookCallbackListener.class)
public class Book implements Serializable{
   ...
   private byte[] image;    

   @Lob @Basic(fetch= FetchType.EAGER)
   public byte[] getImage() {
      return image;
   }
   ...
}
</pre>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test blob/clob support in EJB 3.0.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.entity</i> as explained in the <i>EJB - Create Application</i> chapter. Please use the project created in <i>EJB - Persistence</i> chapter as such for this chapter to understand clob/blob objects in ejb concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>Book.java</i>  under package <i>com.tutorialspoint.entity</i>. Use <i>EJB - Persistence</i> chapter as reference. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Finally, deploy the application in the form of a jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>.</p></td>
</tr>
</table>
<h3>Create/Alter Book Table</h3>
<pre class="prettyprint notranslate">
CREATE TABLE book (
   id     integer PRIMARY KEY,
   name   varchar(50)
);
Alter table book add image bytea;
Alter table book add xml text;
</pre>
<h2>EJBComponent (EJB Module)</h2>
<h3>Book.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.entity;

import com.tutorialspoint.callback.BookCallbackListener;
import java.io.Serializable;
import javax.persistence.Basic;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.EntityListeners;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Lob;
import javax.persistence.Table;

@Entity
@Table(name="book")
public class Book implements Serializable{
    
   private int id;
   private String name;    
   private byte[] image;   
   private String xml;

   public Book() {        
   }

   @Id
   @GeneratedValue(strategy= GenerationType.IDENTITY)
   @Column(name="id")
   public int getId() {
      return id;
   }

   public void setId(int id) {
      this.id = id;
   }

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }

   @Lob @Basic(fetch= FetchType.EAGER)
   public byte[] getImage() {
      return image;
   }

   public void setImage(byte[] image) {
      this.image = image;
   }

   @Lob @Basic(fetch= FetchType.EAGER)
   public String getXml() {
      return xml;
   }

   public void setXml(String xml) {
      this.xml = xml;
   }
}

</pre>
<h3>LibraryPersistentBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Remote;

@Remote
public interface LibraryPersistentBeanRemote {

   void addBook(Book bookName);

   List&lt;Book&gt; getBooks();
    
}
</pre>
<h3>LibraryPersistentBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
    
   public LibraryPersistentBean() {
   }

   @PersistenceContext(unitName="EjbComponentPU")
   private EntityManager entityManager;         

   public void addBook(Book book) {
      entityManager.persist(book);
   }    

   public List&lt;Book&gt; getBooks() {
      return entityManager.createQuery("From Book").getResultList();
   }
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean - <b>LibraryPersistentBean/remote</b>.</p></li>
<li><p>We will using this lookup string to get remote business object of type - <b>com.tutorialspoint.interceptor.LibraryPersistentBeanRemote</b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.interceptor.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibraryPersistentBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.interceptor.LibraryPersistentBeanRemote ejbName: LibraryPersistentBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.interceptor.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateful.LibraryBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.naming.InitialContext;
import javax.naming.NamingException;

public class EJBTester {

   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {

      EJBTester ejbTester = new EJBTester();

      ejbTester.testBlobClob();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testBlobClob() {

      try {
         int choice = 1; 

         LibraryPersistentBeanRemote libraryBean = 
        (LibraryPersistentBeanRemote)
         ctx.lookup("LibraryPersistentBean/remote");

         while (choice != 2) {
            String bookName;
            String publisherName;
            String publisherAddress;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               String xml = "&lt;book&gt;&lt;name&gt;"+bookName+"&lt;/name&gt;&lt;/book&gt;";
               Book book = new Book();
               book.setName(bookName);                                        
               byte[] imageBytes = {0x32, 0x32,0x32, 0x32,0x32,
               0x32,0x32, 0x32,
               0x32, 0x32,0x32, 0x32,0x32, 0x32,0x32, 0x32,
               0x32, 0x32,0x32, 0x32,0x32, 0x32,0x32, 0x32
               };
               book.setImage(imageBytes);
               book.setXml(xml);

               libraryBean.addBook(book);          
            } else if (choice == 2) {
               break;
            }
         }

         List&lt;Book&gt; booksList = libraryBean.getBooks();

         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            byte[] imageByts = book.getImage();
            if(imageByts != null) {
               System.out.print("image bytes: [");
               for(int j = 0; j &lt; imageByts.length ; j++) {
                  System.out.print("0x" 
                  + String.format("%x", imageByts[j]) +" ");
               }            
               System.out.println("]");
            }        
            System.out.println(book.getXml());
            i++;
         }           
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }
}
</pre>
<p>EJBTester performs the following tasks.</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testInterceptedEjb() method, jndi lookup is done with name - "LibraryPersistenceBean/remote" to obtain the remote business object (stateless EJB).</p></li>
<li><p>Then the user is shown a library store User Interface and he/she is asked to enter a choice.</p></li>
<li><p>If the user enters 1, the system asks for book name and saves the book using stateless session bean addBook() method. Session Bean is storing the book in database.</p></li>
<li><p>If the user enters 2, the system retrieves books using stateless session bean getBooks() method and exits.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: learn testing
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. learn testing
image bytes: [
   0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 0x32 ]
&lt;book&gt;&lt;name&gt;learn testing&lt;/name&gt;&lt;/book&gt;
BUILD SUCCESSFUL (total time: 20 seconds)
</pre>
<h1>EJB - Transactions</h1>
<p>A transaction is a single unit of work items, which follows the ACID properties. ACID stands for Atomic, Consistent, Isolated, and Durable.</p>
<ul class="list">
<li><p><b>Atomic</b> &minus; If any of the work item fails, the whole unit will be considered failed. Success meant, all items execute successfully.</p></li>
<li><p><b>Consistent</b> &minus; A transaction must keep the system in consistent state.</p></li>
<li><p><b>Isolated</b> &minus; Each transaction executes independent of any other transaction.</p></li>
<li><p><b>Durable</b> &minus; Transaction should survive system failure if it has been executed or committed.</p></li>
</ul>
<p>EJB Container/Servers are transaction servers and handles transactions context propagation and distributed transactions. Transactions can be managed by the container or by custom code handling in bean's code.</p>
<ul class="list">
<li><p><b>Container Managed Transactions</b> &minus; In this type, the container manages the transaction states.</p></li>
<li><p><b>Bean Managed Transactions</b> &minus; In this type, the developer manages the life cycle of transaction states.</p></li>
</ul>
<h2>Container Managed Transactions</h2>
<p>EJB 3.0 has specified following attributes of transactions, which EJB containers implement &minus;</p>
<ul class="list">
<li><p><b>REQUIRED</b> &minus; Indicates that business method has to be executed within transaction, otherwise a new transaction will be started for that method.</p></li>
<li><p><b>REQUIRES_NEW</b> &minus; Indicates that a new transaction, is to be started for the business method.</p></li>
<li><p><b>SUPPORTS</b> &minus; Indicates that business method will execute as part of transaction.</p></li>
<li><p><b>NOT_SUPPORTED</b> &minus; Indicates that business method should not be executed as part of transaction.</p></li>
<li><p><b>MANDATORY</b> &minus; Indicates that business method will execute as part of transaction, otherwise exception will be thrown.</p></li>
<li><p><b>NEVER</b> &minus; Indicates if business method executes as part of transaction, then an exception will be thrown.</p></li>
</ul>
<h2>Example</h2>
<pre class="prettyprint notranslate">
package com.tutorialspoint.txn.required;
 
import javax.ejb.*
 
@Stateless
@TransactionManagement(TransactionManagementType.CONTAINER)
public class UserDetailBean implements UserDetailRemote {
	
   private UserDetail;

   @TransactionAttribute(TransactionAttributeType.REQUIRED)
   public void createUserDetail() {
      //create user details object
   }
}
</pre>
<p>createUserDetail() business method is made Required using Required annotation.</p>
<pre class="prettyprint notranslate">
package com.tutorialspoint.txn.required;
 
import javax.ejb.*
 
@Stateless
public class UserSessionBean implements UserRemote {
	
   private User;

   @EJB
   private UserDetailRemote userDetail;

   public void createUser() {
      //create user 
      //...
      //create user details
      userDetail.createUserDetail();
   }
}
</pre>
<p>createUser() business method is using createUserDetail(). If exception occurred during createUser() call and User object is not created then UserDetail object will also not be created.</p>
<h2>Bean Managed Transactions</h2>
<p>In Bean Managed Transactions, Transactions can be managed by handling exceptions at application level.</p>
<p>Following are the key points to be considered &minus;</p>
<ul class="list">
<li><p><b>Start</b> &minus; When to start a transaction in a business method.</p></li>
<li><p><b>Sucess</b> &minus; Identify success scenario when a transaction is to be committed.</p></li>
<li><p><b>Failed</b> &minus; Identify failure scenario when a transaction is to be rollback.</p></li>
</ul>
<h3>Example</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.txn.bmt;
 
import javax.annotation.Resource;
import javax.ejb.Stateless;
import javax.ejb.TransactionManagement;
import javax.ejb.TransactionManagementType;
import javax.transaction.UserTransaction;
 
@Stateless
@TransactionManagement(value=TransactionManagementType.BEAN)
public class AccountBean implements AccountBeanLocal {
 
   @Resource
   private UserTransaction userTransaction;

   public void transferFund(Account fromAccount, double fund , 
      Account toAccount) throws Exception{

      try{
         userTransaction.begin();

         confirmAccountDetail(fromAccount);
         withdrawAmount(fromAccount,fund);

         confirmAccountDetail(toAccount);
         depositAmount(toAccount,fund);

         userTransaction.commit();
      }catch (InvalidAccountException exception) {
         userTransaction.rollback();
      }catch (InsufficientFundException exception) {
         userTransaction.rollback();
      }catch (PaymentException exception) {
         userTransaction.rollback();
      }
   }

   private void confirmAccountDetail(Account account) 
      throws InvalidAccountException {
   }

   private void withdrawAmount() throws InsufficientFundException {
   }

   private void depositAmount() throws PaymentException{
   }
}
</pre>
<p>In this example, we made use of <b>UserTransaction</b> interface to mark the beginning of transaction using <b>userTransaction.begin()</b> method call. We mark the completion of transaction, by using  <b>userTransaction.commit()</b> method and if any exception occured during transaction then we rollback the complete transaction using <b>userTransaction.rollback()</b> method call.</p>
<h1>EJB - Security</h1>
<p>Security is a major concern of any enterprise level application. It includes identification of user(s) or system accessing the application. Based on identification, it allows or denies the access to resources within the application. An EJB container manages standard security concerns or it can be customized to handle any specific security concerns.</p>
<h2>Important Terms of Security</h2>
<ul class="list">
<li><p><b>Authentication</b> &minus; This is the process ensuring that user accessing the system or application is verified to be authentic.</p></li>
<li><p><b>Authorization</b> &minus; This is the process ensuring that authentic user has right level of authority to access system resources.</p></li>
<li><p><b>User</b> &minus; User represents the client or system, which accesses the application.</p></li>
<li><p><b>User Groups</b> &minus; Users may be part of the group having certain authorities For example administrator's group.</p></li>
<li><p><b>User Roles</b> &minus; Roles define the level of authority, a user have or permissions to access a system resource.</p></li>
</ul>
<h2>Container Managed Security</h2>
<p>EJB 3.0 has specified following attributes/annotations of security, which EJB containers implement.</p>
<ul class="list">
<li><p><b>DeclareRoles</b> &minus; Indicates that class will accept the declared roles. Annotations are applied at class level.</p></li>
<li><p><b>RolesAllowed</b> &minus; Indicates that a method can be accessed by user of role specified. Can be applied at class level resulting which all methods of class can be accessed buy user of role specified.</p></li>
<li><p><b>PermitAll</b> &minus; Indicates that a business method is accessible to all. It can be applied at class as well as at method level.</p></li>
<li><p><b>DenyAll</b> &minus; Indicates that a business method is not accessible to any of the user specified at class or at method level.</p></li>
</ul>
<h3>Example</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.security.required;
 
import javax.ejb.*
 
@Stateless
@DeclareRoles({"student" "librarian"})
public class LibraryBean implements LibraryRemote {

   @RolesAllowed({"librarian"})
   public void delete(Book book) {
	  //delete book
   }
   
   @PermitAll
   public void viewBook(Book book) {
      //view book
   }
   
   @DenyAll
   public void deleteAll() {
      //delete all books
   } 
}
</pre>
<h2>Security Configuration</h2>
<p>Map roles and user groupd in configuration file.</p>
<pre class="prettyprint notranslate">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE sun-ejb-jar PUBLIC "-//Sun Microsystems, Inc.//DTD Application Server 9.0 EJB 3.0//EN" "http://www.sun.com/software/appserver/dtds/sun-ejb-jar_3_0-0.dtd"&gt;
&lt;ejb-jar&gt;
   &lt;security-role-mapping&gt;
      &lt;role-name&gt;student&lt;/role-name&gt;
      &lt;group-name&gt;student-group&lt;/group-name&gt;
   &lt;/security-role-mapping&gt;
   &lt;security-role-mapping&gt;
      &lt;role-name&gt;librarian&lt;/role-name&gt;
      &lt;group-name&gt;librarian-group&lt;/group-name&gt;
   &lt;/security-role-mapping&gt;  
   &lt;enterprise-beans/&gt;
&lt;/ejb-jar&gt;
</pre>
<h1>EJB - JNDI Bindings</h1>
<p>JNDI stands for Java Naming and Directory Interface. It is a set of API and service interfaces. Java based applications use JNDI for naming and directory services. In context of EJB, there are two terms.</p>
<ul class="list">
<li><p><b>Binding</b> &minus; This refers to assigning a name to an EJB object, which can be used later.</p></li>
<li><p><b>Lookup</b> &minus; This refers to looking up and getting an object of EJB.</p></li>
</ul>
<p>In Jboss, session beans are bound in JNDI in the following format by default.</p>
<ul class="list">
<li><p><b>local</b> &minus; EJB-name/local</p></li>
<li><p><b>remote</b> &minus; EJB-name/remote</p></li>
</ul>
<p>In case, EJB are bundled with &lt;application-name&gt;.ear file, then default format is as following &minus;</p>
<ul class="list">
<li><p><b>local</b> &minus; application-name/ejb-name/local</p></li>
<li><p><b>remote</b> &minus; application-name/ejb-name/remote</p></li>
</ul>
<h2>Example of Default Binding</h2>
<p>Refer to <i>EJB - Create Application</i> chapter's JBoss console output.</p>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibrarySessionBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibrarySessionBean ejbName: LibrarySessionBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

   LibrarySessionBean/remote - EJB3.x Default Remote Business Interface
   LibrarySessionBean/remote-com.tutorialspoint.stateless.LibrarySessionBeanRemote - EJB3.x Remote Business Interface
...
</pre>
<h3>Customized Binding</h3>
<p>Following annotations can be used to customize the default JNDI bindings &minus;</p>
<ul class="list">
<li><p><b>local</b> &minus; org.jboss.ejb3.LocalBinding</p></li>
<li><p><b>remote</b> &minus; org.jboss.ejb3.RemoteBindings</p></li>
</ul>
<p>Update LibrarySessionBean.java. Refer to <i>EJB - Create Application</i> chapter.</p>
<h3>LibrarySessionBean</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;
 
import java.util.ArrayList;
import java.util.List;
import javax.ejb.Stateless;
 
@Stateless
@LocalBinding(jndiBinding="tutorialsPoint/librarySession")
public class LibrarySessionBean implements LibrarySessionBeanLocal {
    
    List&lt;String&gt; bookShelf;    
    
    public LibrarySessionBean() {
       bookShelf = new ArrayList&lt;String&gt;();
    }
    
    public void addBook(String bookName) {
       bookShelf.add(bookName);
    }    
 
    public List&lt;String&gt; getBooks() {
        return bookShelf;
    }
}
</pre>
<h3>LibrarySessionBeanLocal</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;
 
import java.util.List;
import javax.ejb.Local;
 
@Local
public interface LibrarySessionBeanLocal {
 
    void addBook(String bookName);
 
    List getBooks();
    
}
</pre>
<p>Build the project, deploy the application on Jboss, and verify the following output in Jboss console &minus;</p>
<pre class="prettyprint notranslate" >
...
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibrarySessionBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibrarySessionBean ejbName: LibrarySessionBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

   tutorialsPoint/librarySession - EJB3.x Default Local Business Interface
   tutorialsPoint/librarySession-com.tutorialspoint.stateless.LibrarySessionBeanLocal - EJB3.x Local Business Interface
...
</pre>
<h1>EJB - Entity Relationships</h1>
<p>EJB 3.0 provides option to define database entity relationships/mappings like one-to-one, one-to-many, many-to-one, and many-to-many relationships.</p>
<p>Following are the relevant annotations &minus;</p>
<ul class="list">
<li><p><b>One-to-One</b> &minus; Objects have one-to-one relationship. For example, a passenger can travel using a single ticket at a time.</p></li>
<li><p><b>One-to-Many</b> &minus; Objects have one-to-many relationship. For example, a father can have multiple kids.</p></li>
<li><p><b>Many-to-One</b> &minus; Objects have many-to-one relationship. For example, multiple kids having a single mother.</p></li>
<li><p><b>Many-to-Many</b> &minus; Objects have many-to-many relationship. For example, a book can have multiple authors and an author can write multiple books.</p></li>
</ul>
<p>We will demonstrate use of ManyToMany mapping here. To represent ManyToMany relationship, three following tables are required &minus;</p>
<ul class="list">
<li><p><b>Book</b> &minus; Book table, having records of books.</p></li>
<li><p><b>Author</b> &minus; Author table, having records of author.</p></li>
<li><p><b>Book_Author</b> &minus; Book Author table, having linkage of above mentioned Book and Author table.</p></li>
</ul>
<h2>Create Tables</h2>
<p>Create a table <b>book</b> <b>author</b>, <b>book_author</b> in default database <b>postgres</b>.</p>
<pre class="prettyprint notranslate">
CREATE TABLE book (
   book_id     integer,   
   name   varchar(50)      
);

CREATE TABLE author (
   author_id   integer,
   name   varchar(50)      
);

CREATE TABLE book_author (
   book_id     integer,
   author_id   integer 
);
</pre>
<h2>Create Entity Classes</h2>
<pre class="prettyprint notranslate">
@Entity
@Table(name="author")
public class Author implements Serializable{
   private int id;
   private String name;
   ...   
}

@Entity
@Table(name="book")
public class Book implements Serializable{
   private int id;
   private String title;
   private Set&lt;Author&gt; authors;
   ...   
}
</pre>
<p>Use ManyToMany annotation in Book Entity.</p>
<pre class="prettyprint notranslate">
@Entity
public class Book implements Serializable{
   ...
   @ManyToMany(cascade = {CascadeType.PERSIST, CascadeType.MERGE}
      , fetch = FetchType.EAGER)
   @JoinTable(table = @Table(name = "book_author"),
      joinColumns = {@JoinColumn(name = "book_id")},
      inverseJoinColumns = {@JoinColumn(name = "author_id")})
   public Set&lt;Author&gt; getAuthors() {
      return authors;
   }
   ...
}
</pre>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test entity relationships objects in EJB 3.0.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.entity</i> as explained in the <i>EJB - Create Application</i> chapter. Please use the project created in <i>EJB - Persistence</i> chapter as such for this chapter to understand embedded objects in EJB concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>Author.java</i>  under package <i>com.tutorialspoint.entity</i> as explained in the <i>EJB - Create Application</i> chapter. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Create <i>Book.java</i>  under package <i>com.tutorialspoint.entity</i>. Use <i>EJB - Persistence</i> chapter as reference. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">6</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>Author.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.entity;

import java.io.Serializable;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Table;

@Entity
@Table(name="author")
public class Author implements Serializable{
    
   private int id;
   private String name;

   public Author() {}

   public Author(int id, String name) {
      this.id = id;
      this.name = name;
   }
   
   @Id  
   @GeneratedValue(strategy= GenerationType.IDENTITY)
   @Column(name="author_id")
   public int getId() {
      return id;
   }

   public void setId(int id) {
      this.id = id;
   }

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }

   public String toString() {
      return id + "," + name;
   }    
}
</pre>
<h3>Book.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.entity;

import java.io.Serializable;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Table;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;

@Entity
@Table(name="book")
public class Book implements Serializable{

   private int id;
   private String name;
   private Set&lt;Author&gt; authors;

   public Book() {        
   }

   @Id  
   @GeneratedValue(strategy= GenerationType.IDENTITY)
   @Column(name="book_id")
   public int getId() {
      return id;
   }

   public void setId(int id) {
      this.id = id;
   }

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }

   public void setAuthors(Set&lt;Author&gt; authors) {
      this.authors = authors;
   }    
   
   @ManyToMany(cascade = {CascadeType.PERSIST, CascadeType.MERGE}
      , fetch = FetchType.EAGER)
   @JoinTable(table = @Table(name = "book_author"),
      joinColumns = {@JoinColumn(name = "book_id")},
      inverseJoinColumns = {@JoinColumn(name = "author_id")})
   public Set&lt;Author&gt; getAuthors() {
      return authors;
   }
}
</pre>
<h3>LibraryPersistentBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Remote;

@Remote
public interface LibraryPersistentBeanRemote {

   void addBook(Book bookName);

   List&lt;Book&gt; getBooks();
    
}
</pre>
<h3>LibraryPersistentBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Stateless;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
    
   public LibraryPersistentBean() {
   }

   @PersistenceContext(unitName="EjbComponentPU")
   private EntityManager entityManager;         

   public void addBook(Book book) {
      entityManager.persist(book);
   }    

   public List&lt;Book&gt; getBooks() {
      return entityManager.createQuery("From Book").getResultList();
   }
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean &minus; <b>LibraryPersistentBean/remote</b>.</p></li>
<li><p>We will using this lookup string to get remote business object of type &minus; <b>com.tutorialspoint.interceptor.LibraryPersistentBeanRemote</b></p></li>
</ul>
<h2>JBoss Application Server Log Output</h2>
<pre class="result notranslate">
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.interceptor.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibraryPersistentBean,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.interceptor.LibraryPersistentBeanRemote ejbName: LibraryPersistentBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.interceptor.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateful.LibraryBeanRemote;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;

import java.util.*;

import javax.naming.InitialContext;
import javax.naming.NamingException;

public class EJBTester {

   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {

      EJBTester ejbTester = new EJBTester();

      ejbTester.testEmbeddedObjects();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testEmbeddedObjects() {

      try {
         int choice = 1; 

         LibraryPersistentBeanRemote libraryBean = 
         (LibraryPersistentBeanRemote)
         ctx.lookup("LibraryPersistentBean/remote");

         while (choice != 2) {
            String bookName;
            String authorName;
            
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               System.out.print("Enter author name: ");
               authorName = brConsoleReader.readLine();               
               Book book = new Book();
               book.setName(bookName);
               Author author = new Author();
               author.setName(authorName);
               Set&lt;Author&gt; authors = new HashSet&lt;Author&gt;();
               authors.add(author);
               book.setAuthors(authors);

               libraryBean.addBook(book);          
            } else if (choice == 2) {
               break;
            }
         }

         List&lt;Book&gt; booksList = libraryBean.getBooks();

         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            System.out.print("Author: ");
            Author[] authors = (Author[])books.getAuthors().toArray();
            for(int j=0;j&lt;authors.length;j++) {
               System.out.println(authors[j]);
            }
            i++;
         }           
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testInterceptedEjb() method, jndi lookup is done with name - "LibraryPersistenceBean/remote" to obtain the remote business object (stateless EJB).</p></li>
<li><p>Then the user is shown a library store User Interface and he/she is asked to enter a choice.</p></li>
<li><p>If the user enters 1, the system asks for book name and saves the book using stateless session bean addBook() method. Session Bean is storing the book in database.</p></li>
<li><p>If the user enters 2, the system retrieves books using stateless session bean getBooks() method and exits.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: learn html5
Enter Author name: Robert
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. learn html5
Author: Robert
BUILD SUCCESSFUL (total time: 21 seconds)
</pre>
<h1>EJB - Access Database</h1>
<p>In EJB 3.0, persistence mechanism is used to access the database in which the container manages the database related operations. Developers can access database using JDBC API call directly in EJB business methods.</p>
<p>To demonstrate database access in EJB, we need to perform the following tasks &minus;</p>
<ul class="list">
<li><p><b>Step 1</b> &minus; Create a table in the database.</p></li>
<li><p><b>Step 2</b> &minus; Create a stateless EJB having business me.</p></li>
<li><p><b>Step 3</b> &minus; Update stateless EJB. Add methods to add records and get records from database via entity manager.</p></li>
<li><p><b>Step 4</b> &minus; A console based application client will access the stateless EJB to persist data in database.</p></li>
</ul>
<h2>Create Table</h2>
<p>Create a table <b>books</b> in default database <b>postgres</b>.</p>
<pre class="prettyprint notranslate">
CREATE TABLE books (
   id     integer PRIMARY KEY,
   name   varchar(50)
);
</pre>
<h2>Create a Model Class</h2>
<pre class="prettyprint notranslate">
public class Book implements Serializable{
    
   private int id;
   private String name;

   public Book() {        
   }
   
   public int getId() {
      return id;
   }
   ...
}
</pre>
<h2>Create Stateless EJB</h2>
<pre class="prettyprint notranslate">
@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
	
   public void addBook(Book book) {
     //persist book using jdbc calls
   }    

   public List&lt;Book&gt; getBooks() {        
     //get books using jdbc calls
   }
   ...
}
</pre>
<p>After building the EJB module, we need a client to access the stateless bean, which we will be going to create in the next section.</p>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test EJB database access mechanism.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.entity</i> as explained in the <i>EJB - Create Application</i> chapter. You can also use the project created in <i>EJB - Create Application</i> chapter as such for this chapter to understand EJB data access concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>Book.java</i> under package <i>com.tutorialspoint.entity</i> and modify it as shown below.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Create <i>LibraryPersistentBean.java</i> and <i>LibraryPersistentBeanRemote</i> as explained in the <i>EJB - Create Application</i> chapter and modify them as shown below.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">6</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>. Modify it as shown below.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>Book.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.entity;

import java.io.Serializable;

public class Book implements Serializable{
    
   private int id;
   private String name;

   public Book() {        
   }
   
   public int getId() {
      return id;
   }

   public void setId(int id) {
      this.id = id;
   }

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }    
}
</pre>
<h3>LibraryPersistentBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Remote;

@Remote
public interface LibraryPersistentBeanRemote {

   void addBook(Book bookName);

   List&lt;Book&gt; getBooks();
    
}
</pre>
<h3>LibraryPersistentBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;
import javax.ejb.Stateless;

@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
    
   public LibraryPersistentBean() {
   }

   public void addBook(Book book) {
      Connection con = null;
      String url = "jdbc:postgresql://localhost:5432/postgres";
      String driver = "org.postgresql.driver";

      String userName = "sa";
      String password = "sa";
      List&lt;Book&gt; books = new ArrayList&lt;Book&gt;();
      try {

         Class.forName(driver).newInstance();
         con = DriverManager.getConnection(url , userName, password);

         PreparedStatement st = 
         con.prepareStatement("insert into book(name) values(?)");
         st.setString(1,book.getName());

         int result = st.executeUpdate();                

      } catch (SQLException ex) {
         ex.printStackTrace();
      } catch (InstantiationException ex) {
         ex.printStackTrace();
      } catch (IllegalAccessException ex) {
         ex.printStackTrace();
      } catch (ClassNotFoundException ex) {
         ex.printStackTrace();
      }    
   }    

   public List&lt;Book&gt; getBooks() {
      Connection con = null;
      String url = "jdbc:postgresql://localhost:5432/postgres";
      String driver = "org.postgresql.driver";
   
      String userName = "sa";
      String password = "sa";
      List&lt;Book&gt; books = new ArrayList&lt;Book&gt;();
      try {

         Class.forName(driver).newInstance();
         con = DriverManager.getConnection(url , userName, password);

         Statement st = con.createStatement();
         ResultSet rs = st.executeQuery("select * from book");

         Book book;
         while (rs.next()) {
            book = new Book();
            book.setId(rs.getInt(1));                 
            book.setName(rs.getString(2));
            books.add(book);
         }
      } catch (SQLException ex) {
         ex.printStackTrace();
      } catch (InstantiationException ex) {
         ex.printStackTrace();
      } catch (IllegalAccessException ex) {
         ex.printStackTrace();
      } catch (ClassNotFoundException ex) {
         ex.printStackTrace();
      }
      return books;
   }
}

</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean - <b>LibraryPersistentBean/remote</b>.</p></li>
<li><p>We will be using this lookup string to get remote business object of type &minus;
<b>com.tutorialspoint.stateless.LibraryPersistentBeanRemote</b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.stateless.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibraryPersistentBeanRemote,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibraryPersistentBeanRemote ejbName: LibraryPersistentBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.stateless.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateless.LibraryPersistentBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.naming.InitialContext;
import javax.naming.NamingException;

public class EJBTester {

   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {

      EJBTester ejbTester = new EJBTester();

      ejbTester.testEntityEjb();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testEntityEjb() {

      try {
         int choice = 1; 

         LibraryPersistentBeanRemote libraryBean =
         LibraryPersistentBeanRemote)
         ctx.lookup("LibraryPersistentBean/remote");

         while (choice != 2) {
            String bookName;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               Book book = new Book();
               book.setName(bookName);
               libraryBean.addBook(book);          
            } else if (choice == 2) {
               break;
            }
         }

         List&lt;Book&gt; booksList = libraryBean.getBooks();

         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            i++;
         }           
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testStatefulEjb() method, jndi lookup is done with the name - "LibraryStatelessSessionBean/remote" to obtain the remote business object (stateful EJB).</p></li>
<li><p>Then user is shown a library store User Interface and he/she is asked to enter a choice.</p></li>
<li><p>If the user enters 1, the system asks for book name and saves the book using stateless session bean addBook() method. Session Bean is persisting the book in database via EntityManager call.</p></li>
<li><p>If the user enters 2, the system retrieves books using stateless session bean getBooks() method and exits.</p></li>
<li><p>Then another jndi lookup is done with the name - "LibraryStatelessSessionBean/remote" to obtain the remote business object (stateful EJB) again and listing of books is done.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn Java
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. learn java
BUILD SUCCESSFUL (total time: 15 seconds)
</pre>
<h1>EJB - Query Language</h1>
<p><b>EJB Query Language</b> is quite handy to write custom queries without worrying about underlying database details. It is quite similar to HQL, hibernate query language and is often referred by the name EJBQL.</p>
<p>To demonstrate EJBQL in EJB, we are going to do the following tasks &minus;</p>
<ul class="list">
<li><p><b>Step 1</b> &minus; Create table in database.</p></li>
<li><p><b>Step 2</b> &minus; Create a stateless EJB having business me.</p></li>
<li><p><b>Step 3</b> &minus;Update stateless EJB. Add methods to add records and get records from database via entity manager.</p></li>
<li><p><b>Step 4</b> &minus; A console based application client will access the stateless EJB to persist data in database.</p></li>
</ul>
<h2>Create Table</h2>
<p>Create a table <b>books</b> in default database <b>postgres</b>.</p>
<pre class="prettyprint notranslate">
CREATE TABLE books (
   id     integer PRIMARY KEY,
   name   varchar(50)
);
</pre>
<h2>Create a Model Class</h2>
<pre class="prettyprint notranslate">
public class Book implements Serializable{
    
   private int id;
   private String name;

   public Book() {        
   }
   
   public int getId() {
      return id;
   }
   ...
}
</pre>
<h2>Create Stateless EJB</h2>
<pre class="prettyprint notranslate">
@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
	
   public void addBook(Book book) {
     //persist book using entity manager
   }    

   public List&lt;Book&gt; getBooks() {        
     //get books using entity manager
   }
   ...
}
</pre>
<p>After building the EJB module, we need a client to access the stateless bean, which we will be going to create in the next section.</p>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test EJB database access mechanism.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name <i>EjbComponent</i> under a package <i>com.tutorialspoint.entity</i> as explained in the <i>EJB - Create Application</i> chapter. You can also use the project created in <i>EJB - Create Application</i> chapter as such for this chapter to understand EJB data access concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create <i>Book.java</i> under package <i>com.tutorialspoint.entity</i> and modify it as shown below.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Create <i>LibraryPersistentBean.java</i> and <i>LibraryPersistentBeanRemote</i> as explained in the <i>EJB - Create Application</i> chapter and modify them as shown below.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">5</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
<tr>
<td class="ts">6</td>
<td><p>Now create the EJB client, a console based application in the same way as explained in the <i>EJB - Create Application</i> chapter under topic <b>Create Client to access EJB</b>. Modify it as shown below.</p></td>
</tr>
</table>
<h2>EJBComponent (EJB Module)</h2>
<h3>Book.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.entity;

import java.io.Serializable;

public class Book implements Serializable{
    
   private int id;
   private String name;

   public Book() {        
   }
   
   public int getId() {
      return id;
   }

   public void setId(int id) {
      this.id = id;
   }

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }    
}
</pre>
<h3>LibraryPersistentBeanRemote.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Remote;

@Remote
public interface LibraryPersistentBeanRemote {
   void addBook(Book bookName);
   List&lt;Book&gt; getBooks();
}
</pre>
<h3>LibraryPersistentBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
    
   public LibraryPersistentBean() {
   }

   @PersistenceContext(unitName="EntityEjbPU")
   private EntityManager entityManager;         

   public void addBook(Book book) {
      entityManager.persist(book);
   }    

   public List&lt;Book&gt; getBooks() {
      //create an ejbql expression
      String ejbQL = "From Book b where b.name like ?1";
      //create query
      Query query = entityManager.createQuery(ejbQL);
      //substitute parameter.
      query.setParameter(1, "%test%");   
      //execute the query
      return query.getResultList();
   }   
}
</pre>
<ul class="list">
<li><p>As soon as you deploy the EjbComponent project on JBOSS, notice the jboss log.</p></li>
<li><p>JBoss has automatically created a JNDI entry for our session bean &minus; <b>LibraryPersistentBean/remote</b>.</p></li>
<li><p>We will be using this lookup string to get remote business object of type &minus; 
<b>com.tutorialspoint.stateless.LibraryPersistentBeanRemote</b></p></li>
</ul>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate" >
...
16:30:01,401 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:
   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.stateless.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
16:30:02,723 INFO  [SessionSpecContainer] Starting jboss.j2ee:jar=EjbComponent.jar,name=LibraryPersistentBeanRemote,service=EJB3
16:30:02,723 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibraryPersistentBeanRemote ejbName: LibraryPersistentBean
16:30:02,731 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

   LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
   LibraryPersistentBean/remote-com.tutorialspoint.stateless.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface
...   
</pre>
<h2>EJBTester (EJB Client)</h2>
<h3>jndi.properties</h3>
<pre class="prettyprint notranslate">
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost
</pre>
<ul class="list">
<li><p>These properties are used to initialize the InitialContext object of java naming service.</p></li>
<li><p>InitialContext object will be used to lookup stateless session bean.</p></li>
</ul>
<h3>EJBTester.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.test;
   
import com.tutorialspoint.stateless.LibraryPersistentBeanRemote;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.List;
import java.util.Properties;
import javax.naming.InitialContext;
import javax.naming.NamingException;

public class EJBTester {

   BufferedReader brConsoleReader = null; 
   Properties props;
   InitialContext ctx;
   {
      props = new Properties();
      try {
         props.load(new FileInputStream("jndi.properties"));
      } catch (IOException ex) {
         ex.printStackTrace();
      }
      try {
         ctx = new InitialContext(props);            
      } catch (NamingException ex) {
         ex.printStackTrace();
      }
      brConsoleReader = 
      new BufferedReader(new InputStreamReader(System.in));
   }
   
   public static void main(String[] args) {

      EJBTester ejbTester = new EJBTester();

      ejbTester.testEntityEjb();
   }
   
   private void showGUI() {
      System.out.println("**********************");
      System.out.println("Welcome to Book Store");
      System.out.println("**********************");
      System.out.print("Options \n1. Add Book\n2. Exit \nEnter Choice: ");
   }
   
   private void testEntityEjb() {

      try {
         int choice = 1; 

         LibraryPersistentBeanRemote libraryBean =
         LibraryPersistentBeanRemote)
         ctx.lookup("LibraryPersistentBean/remote");

         while (choice != 2) {
            String bookName;
            showGUI();
            String strChoice = brConsoleReader.readLine();
            choice = Integer.parseInt(strChoice);
            if (choice == 1) {
               System.out.print("Enter book name: ");
               bookName = brConsoleReader.readLine();
               Book book = new Book();
               book.setName(bookName);
               libraryBean.addBook(book);          
            } else if (choice == 2) {
               break;
            }
         }

         List&lt;Book&gt; booksList = libraryBean.getBooks();

         System.out.println("Book(s) entered so far: " + booksList.size());
         int i = 0;
         for (Book book:booksList) {
            System.out.println((i+1)+". " + book.getName());
            i++;
         }           
      } catch (Exception e) {
         System.out.println(e.getMessage());
         e.printStackTrace();
      }finally {
         try {
            if(brConsoleReader !=null) {
               brConsoleReader.close();
            }
         } catch (IOException ex) {
            System.out.println(ex.getMessage());
         }
      }
   }
}
</pre>
<p>EJBTester performs the following tasks &minus;</p>
<ul class="list">
<li><p>Load properties from jndi.properties and initialize the InitialContext object.</p></li>
<li><p>In testStatefulEjb() method, jndi lookup is done with the name - "LibraryStatelessSessionBean/remote" to obtain the remote business object (stateful ejb).</p></li>
<li><p>Then user is shown a library store User Interface and he/she is asked to enter a choice.</p></li>
<li><p>If the user enters 1, the system asks for book name and saves the book using stateless session bean addBook() method. Session Bean is persisting the book in database via EntityManager call.</p></li>
<li><p>If the user enters 2, the system retrieves books using stateless session bean getBooks() method and exits.</p></li>
<li><p>Then another jndi lookup is done with name - "LibraryStatelessSessionBean/remote" to obtain the remote business object (stateful EJB) again and listing of books is done.</p></li>
</ul>
<h2>Run Client to Access EJB</h2>
<p>Locate EJBTester.java in project explorer. Right click on EJBTester class and select <b>run file</b>.</p>
<p>Verify the following output in Netbeans console.</p>
<pre class="result notranslate">
run:
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 1
Enter book name: Learn Testing
**********************
Welcome to Book Store
**********************
Options 
1. Add Book
2. Exit 
Enter Choice: 2
Book(s) entered so far: 1
1. learn Testing
BUILD SUCCESSFUL (total time: 15 seconds)
</pre>
<h1>EJB - Exception Handling</h1>
<p>EJBs are a part of enterprise applications which are normally based on distributed environments. So, apart from the normal exceptions that can occur, there can be exceptions like communication failure, security permissions, server down, etc.</p>
<p>EJB container considers exceptions in two ways &minus;</p>
<ul class="list">
<li><p><b>Application Exception</b> &minus; If business rule is violated or exception occurs while executing the business logic.</p></li>
<li><p><b>System Exception</b> &minus; Any exception, which is not caused by business logic or business code. RuntimeException, RemoteException are SystemException. For example, error during EJB lookup. RuntimeException, RemoteException are SystemException.</p></li>
</ul>
<h2>How Does EJB Container Handle Exceptions?</h2>
<p>When <b>Application Exception</b> occurs, EJB container intercepts the exception, but returns the same to the client as it is. It does not roll back the transaction unless it is specified in the code by EJBContext.setRollBackOnly() method. EJB Container does not wrap the exception in case of Application Exception.</p>
<p>When <b>System Exception</b> occurs, EJB container intercepts the exception, rollbacks the transaction and start the clean up tasks. It wraps the exception into RemoteException and throws it to the client.</p>
<h2>Handling Application Exception</h2>
<p>Application exceptions are generally thrown in Session EJB methods as these are the methods responsible to execute business logic. Application exception should be declared in throws clause of business method and should be thrown in case business logic fails.</p>
<pre class="prettyprint notranslate">
@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
	
   ...

   public List&lt;Book&gt; getBooks() throws NoBookAvailableException {        
      List&lt;Book&gt; books = 
         entityManager.createQuery("From Books").getResultList();
      if(books.size == 0)
		throw NoBookAvailableException
           ("No Book available in library.");
      return books;
   }
   ...
}
</pre>
<h2>Handling System Exception</h2>
<p>System exception can occur at any time like naming lookup fails, sql error occurs while fetching data. In such a case, such exception should be wrapped under EJBException and thrown back to the client.</p>
<pre class="prettyprint notranslate">
@Stateless
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
	
   ...

   public List&lt;Book&gt; getBooks() {   
      try {
         List&lt;Book&gt; books = 
            entityManager.createQuery("From Books").getResultList();
      } catch (CreateException ce) {
         throw (EJBException) new EJBException(ce).initCause(ce);
      } catch (SqlException se) {
         throw (EJBException) new EJBException(se).initCause(se);    
      }	  
      return books;
   }
   ...
}
</pre>
<p>At client side, handle the EJBException.</p>
<pre class="prettyprint notranslate">
public class EJBTester {
   private void testEntityEjb() {
   ...
   try{
      LibraryPersistentBeanRemote libraryBean =
      LibraryPersistentBeanRemote)ctx.lookup("LibraryPersistentBean/remote");
   
      List&lt;Book&gt; booksList = libraryBean.getBooks();
   } catch(EJBException e) {
      Exception ne = (Exception) e.getCause();
      if(ne.getClass().getName().equals("SqlException")) {
         System.out.println("Database error: "+ e.getMessage());
      }
   }
   ...
   }
}
</pre>
<h1>EJB - Web Services</h1>
<p>EJB 3.0 provides an option to expose session EJB as a webservice. @WebService annotation is used to mark a class as a web service end point and @WebMethod is used to expose a method as web method to client.</p>
<pre class="prettyprint notranslate">
@Stateless
@WebService(serviceName="LibraryService")
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
	
   ...
   @WebMethod(operationName="getBooks")
   public List&lt;Book&gt; getBooks()  {    
      return entityManager.createQuery("From Books").getResultList();
   }
   ...
}
</pre>
<h2>Example Application</h2>
<p>Let us create a test EJB application to test blob/clob support in EJB 3.0.</p>
<table class="table table-bordered">
<tr>
<th>Step</th>
<th style="text-align:center">Description</th>
</tr>
<tr>
<td class="ts">1</td>
<td><p>Create a project with a name EjbComponent under a package com.tutorialspoint.entity as explained in the EJB - Create Application chapter. Please use the project created in EJB - Persistence chapter as such for this chapter to understand clob/blob objects in  EJB concepts.</p></td>
</tr>
<tr>
<td class="ts">2</td>
<td><p>Create LibraryPersistentBean.java under package com.tutorialspoint.stateless. Use EJB - Persistence chapter as reference. Keep rest of the files unchanged.</p></td>
</tr>
<tr>
<td class="ts">3</td>
<td><p>Clean and Build the application to make sure business logic is working as per the requirements.</p></td>
</tr>
<tr>
<td class="ts">4</td>
<td><p>Finally, deploy the application in the form of jar file on JBoss Application Server. JBoss Application server will get started automatically if it is not started yet.</p></td>
</tr>
</table>
<h3>LibraryPersistentBean.java</h3>
<pre class="prettyprint notranslate">
package com.tutorialspoint.stateless;

import com.tutorialspoint.entity.Book;
import java.util.List;
import javax.ejb.Stateless;
import javax.jws.WebMethod;
import javax.jws.WebService;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

@Stateless
@WebService(serviceName="LibraryService")
public class LibraryPersistentBean implements LibraryPersistentBeanRemote {
    
   public LibraryPersistentBean() {
   }

   @PersistenceContext(unitName="EjbComponentPU")
   private EntityManager entityManager;         

   public void addBook(Book book) {
      entityManager.persist(book);
   }    
   
   @WebMethod(operationName="getBooks")
   public List &lt;Book&gt; getBooks() {
      return entityManager.createQuery("From Book").getResultList();
   }
}
</pre>
<h3>JBoss Application Server Log Output</h3>
<pre class="result notranslate">
10:51:37,271 INFO  [EJBContainer] STARTED EJB: com.tutorialspoint.stateless.LibraryPersistentBean ejbName: LibraryPersistentBean
10:51:37,287 INFO  [JndiSessionRegistrarBase] Binding the following Entries in Global JNDI:

	LibraryPersistentBean/remote - EJB3.x Default Remote Business Interface
	LibraryPersistentBean/remote-com.tutorialspoint.stateless.LibraryPersistentBeanRemote - EJB3.x Remote Business Interface

10:51:37,349 INFO  [EJBContainer] STARTED EJB: com.tuturialspoint.messagebean.LibraryMessageBean ejbName: BookMessageHandler
10:51:37,443 INFO  [DefaultEndpointRegistry] register: jboss.ws:context=EjbComponent,endpoint=LibraryPersistentBean
10:51:38,191 INFO  [WSDLFilePublisher] WSDL published to: file:/D:/Jboss-5.0.1/server/default/data/wsdl/EjbComponent.jar/
LibraryService3853081455302946642.wsdl
</pre>
<h2>Create Client to Access EJB as Web Service</h2>
<p>In NetBeans IDE, select <b>,File &gt; New Project &gt;</b>.Select project type under category ,<b>Java</b>, Project type as <b>Java Application</b>. Click <b>Next &gt;</b> button.Enter project name and location. Click <b>Finish &gt;</b> button. We have chosen name as EJBWebServiceClient.</p>
<p>Right click on the project name in Project explorer window. Select <b>New &gt; WebService Client</b>.</p>
<img src="/ejb/images/wsdl_client.jpg" alt="WSDL Client" />
<p>Add EJB component project's LibraryPersistentBean created earlier under WSDL and Client Location using <b>Add Project</b> button in <b>compile</b> tab.</p>
<img src="/ejb/images/wsdl_bean.jpg" alt="Web Service Bean" />
<p>Click Finish Button. Verify the following structure in project explorer.</p>
<img src="/ejb/images/project_structure.jpg" alt="Web Service Bean" />
<h3>Create EJBWebServiceClient.java</h3>
<pre class="prettyprint notranslate">
package ejbwebserviceclient;

public class EJBWebServiceClient {
   public static void main(String[] args) {   
   }
}
</pre>
<p>Select Web Service getBooks web method as shown in the figure below and drag it to code window of EJBWebServiceClient.</p>
<img src="/ejb/images/method_drop.jpg" alt="Web Service Method drag" />
<p>You will see the output similar to as shown below.</p>
<img src="/ejb/images/method_dropped.jpg" alt="Web Service Method dragged" />
<p>Update the EJBWebServiceClient code to use this method.</p>
<pre class="result notranslate">
package ejbwebserviceclient;

public class EJBWebServiceClient {

   public static void main(String[] args) {
      for(com.tutorialspoint.stateless.Book book:getBooks()) {
         System.out.println(book.getName());
      }       
   }

   private static java.util.List
   &lt;com.tutorialspoint.stateless.Book&gt; getBooks() {
      com.tutorialspoint.stateless.LibraryService service = 
         new com.tutorialspoint.stateless.LibraryService();
      com.tutorialspoint.stateless.LibraryPersistentBean port = 
         service.getLibraryPersistentBeanPort();
      return port.getBooks();
   }      
}
</pre>
<h2>Run the Client</h2>
<p>Right click on the project name in Project explorer window. Select <b>Run</b>. Netbeans will build the client and run it. Verify the following output.</p>
<pre class="result notranslate">
ant -f D:\\SVN\\EJBWebServiceClient run
init:
Deleting: D:\SVN\EJBWebServiceClient\build\built-jar.properties
deps-jar:
Updating property file: D:\SVN\EJBWebServiceClient\build\built-jar.properties
wsimport-init:
wsimport-client-LibraryPersistentBean:
files are up to date
classLoader = java.net.URLClassLoader@4ce46c
SharedSecrets.getJavaNetAccess()=java.net.URLClassLoader$7@182cdac
wsimport-client-generate:
Compiling 1 source file to D:\SVN\EJBWebServiceClient\build\classes
compile:
run:
learn java
Learn Spring
learn JSF
Learn HTML
Learn JBoss
Learn EJB
Learn Hibernate
Learn IBatis
Times Now
learn html5
Learn images
Learn Testing
Forbes
test1
BUILD SUCCESSFUL (total time: 1 second)
</pre>
<h1>EJB - Packaging Applications</h1>
<p>Requirement of Packaging applications using EJB 3.0 are similar to that of J2EE platform. EJB components are packaged into modules as jar files and are packaged into application enterprise archive as ear file.</p>
<p>There are majorly three components of any enterprise application &minus;</p>
<ul class="list">
<li><p><b>jar</b> &minus; Java Application aRchive, containing EJB modules, EJB client modules and utility modules.</p></li>
<li><p><b>war</b> &minus; Web Application aRchive, containing web modules.</p></li>
<li><p><b>ear</b> &minus; Enterprise Application aRchive, containing jars and war module.</p></li>
</ul>
<img src="/ejb/images/ear_structure.jpg" alt="EAR" />
<p>In NetBeans, it is very easy to create, develop, package, and deploy the J2EE applications.</p>
<p>In NetBeans IDE, select ,<b>File &gt; New Project &gt;</b>.Select project type under category,<b>Java EE</b>, Project type as <b>Enterprise Application</b>. Click <b>Next &gt;</b> button. Enter project name and location. Click <b>Finish &gt;</b> button. We've chosen name as EnterpriseApplicaton.</p>
<p>Select Server and Settings. Keep <b>Create EJB Module</b> and <b>Create Web Application Module</b> checked with default names provided. Click finish button. NetBeans will create the following structure in project window.</p>
<img src="/ejb/images/ear_project.jpg" alt="EAR Project" />
<p>Right click on the Project <b>Enterprise Application</b> in project explorer and select Build.</p>
<pre class="prettyprint notranslate">
ant -f D:\\SVN\\EnterpriseApplication dist
pre-init:
init-private:
init-userdir:
init-user:
init-project:
do-init:
post-init:
init-check:
init:
deps-jar:
deps-j2ee-archive:
EnterpriseApplication-ejb.init:
EnterpriseApplication-ejb.deps-jar:
EnterpriseApplication-ejb.compile:
EnterpriseApplication-ejb.library-inclusion-in-manifest:

Building jar: D:\SVN\EnterpriseApplication\EnterpriseApplication-ejb\dist\EnterpriseApplication-ejb.jar

EnterpriseApplication-ejb.dist-ear:
EnterpriseApplication-war.init:
EnterpriseApplication-war.deps-module-jar:
EnterpriseApplication-war.deps-ear-jar:
EnterpriseApplication-ejb.init:
EnterpriseApplication-ejb.deps-jar:
EnterpriseApplication-ejb.compile:
EnterpriseApplication-ejb.library-inclusion-in-manifest:
EnterpriseApplication-ejb.dist-ear:
EnterpriseApplication-war.deps-jar:
EnterpriseApplication-war.library-inclusion-in-archive:
EnterpriseApplication-war.library-inclusion-in-manifest:
EnterpriseApplication-war.compile:
EnterpriseApplication-war.compile-jsps:
EnterpriseApplication-war.do-ear-dist:

Building jar: D:\SVN\EnterpriseApplication\EnterpriseApplication-war\dist\EnterpriseApplication-war.war

EnterpriseApplication-war.dist-ear:
pre-pre-compile:
pre-compile:
Copying 1 file to D:\SVN\EnterpriseApplication\build
Copying 1 file to D:\SVN\EnterpriseApplication\build
do-compile:
post-compile:
compile:
pre-dist:
do-dist-without-manifest:
do-dist-with-manifest:

Building jar: D:\SVN\EnterpriseApplication\dist\EnterpriseApplication.ear

post-dist:
dist:
BUILD SUCCESSFUL (total time: 1 second)
</pre>
<p>Here you can see, that Netbeans prepares Jar first, then War and in the end, the ear file carrying the jar and war, file. Each jar,war and ear file carries a <b>meta-inf</b> folder to have meta data as per the J2EE specification.</p>
<div class="mui-container-fluid button-borders show">
<div class="pre-btn">
<a href="/ejb/ejb_packaging_applications.htm"><i class="fal fa-chevron-circle-left"></i> Previous Page</a>
</div>
<div class="nxt-btn">
<a href="/ejb/ejb_useful_resources.htm">Next Page <i class="fal fa-chevron-circle-right"></i>&nbsp;</a>
</div>
</div>
<div class="google-bottom-ads">
<div>Advertisements</div>
<script><!--
var width = 580;
var height = 400;
var format = "580x400_as";
if( window.innerWidth < 468 ){
   width = 300;
   height = 250;
   format = "300x250_as";
}
google_ad_client = "pub-7133395778201029";
google_ad_width = width;
google_ad_height = height;
google_ad_format = format;
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<div class="space-bottom"></div>
</div>
</div>
<!-- Tutorial Content Ends Here -->
<!-- Right Column Starts Here -->
<div class="mui-col-md-2 google-right-ads">
<div class="space-top"></div>
<div class="google-right-ad" style="margin: 0px auto !important;margin-top:5px;">
<script><!--
google_ad_client = "pub-2537027957187252";
google_ad_width = 300;
google_ad_height = 250;
google_ad_format = "300x250_as";
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<div class="google-right-ad">
<div class="adsbyvli" data-ad-slot="vi_9012177"></div>
<script>(vitag.Init = window.vitag.Init || []).push(function(){viAPItag.display("vi_9012177")})</script>
</div>
<div class="space-bottom"></div>
<div class="google-right-ad">
<div class="adsbyvli" data-ad-slot="vi_9013289"></div>
<script>(vitag.Init = window.vitag.Init || []).push(function(){viAPItag.display("vi_9013289")})</script>
</div>
<div class="space-bottom" style="margin-bottom:15px;"></div>
</div>
<!-- Right Column Ends Here -->
</div>
</div>
<div class="clear"></div>
<footer id="footer">
<div class="mui--text-center">
<div class="mui--text-caption mui--text-light">
<a href="/index.htm" class="logo"><img class="img-responsive" src="/images/logo-black.png" alt="Tutorials Point" title="Tutorials Point"></a>
</div>
<ul class="mui-list--inline mui--text-body2 mui--text-light">
<li><a href="/about/index.htm"><i class="fal fa-globe"></i> About us</a></li>
<li><a href="/about/about_terms_of_use.htm"><i class="fal fa-asterisk"></i> Terms of use</a></li>
<li><a href="/about/about_privacy.htm#cookies"> <i class="fal fa-shield-check"></i> Cookies Policy</a></li>
<li><a href="/about/faq.htm"><i class="fal fa-question-circle"></i> FAQ's</a></li>
<li><a href="/about/about_helping.htm"><i class="fal fa-hands-helping"></i> Helping</a></li>
<li><a href="/about/contact_us.htm"><i class="fal fa-map-marker-alt"></i> Contact</a></li>
</ul>
<div class="mui--text-caption mui--text-light bottom-copyright-text">&copy; Copyright 2019. All Rights Reserved.</div>
</div>
<div id="privacy-banner">
  <div>
    <p>
      We use cookies to provide and improve our services. By using our site, you consent to our Cookies Policy.
      <a id="banner-accept" href="#">Accept</a>
      <a id="banner-learn" href="/about/about_cookies.htm" target="_blank">Learn more</a>
    </p>
  </div>
</div>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-232293-17"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-232293-6');
</script>
</footer>
</body>
</html>
